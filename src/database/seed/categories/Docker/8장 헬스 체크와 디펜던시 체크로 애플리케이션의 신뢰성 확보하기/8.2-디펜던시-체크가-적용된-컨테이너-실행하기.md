---
title: "8.2 디펜던시 체크가 적용된 컨테이너 실행하기"
categoryPath:
  - "Docker"
  - "8장 헬스 체크와 디펜던시 체크로 애플리케이션의 신뢰성 확보하기"
  - "8.2 디펜던시 체크가 적용된 컨테이너 실행하기"
authorNick: "관리자"
createdAt: "2025-08-27"
updateMode: "upsert"
---

# 8.2 디펜던시 체크가 적용된 컨테이너 실행하기
- 여러 컨테이너가 협업하는 환경에서는, 특정 서비스가 아직 준비되지 않은 상태에서 다른 서비스가 먼저 시작되는 경우가 있습니다. 
- 예를 들어, 웹 애플리케이션은 API 서버(`numbers-api`)에 의존하고, API 서버는 데이터베이스에 의존합니다.
- 따라서, 디펜던시 체크를 통해 애플리케이션 실행 전 필요한 요구 사항을 확인하도록 합니다.
- 디펜던시 체크는 "내가 의존하는 서비스가 준비되었는가?"를 주기적으로 확인한 뒤 본 애플리케이션을 실행하는 로직입니다. 보통 헬스체크와는 다르게 별도의 인스트럭션이 아닌 `CMD`, `ENTRYPOINT` 단계에서 스크립트를 추가해 구현하게 됩니다.

```dockerfile
FROM diamol/dotnet-aspnet

ENV RngApi:Url=http://numbers-api/rng

CMD curl --fail <http://numbers-api/rng> && \\
		dotnet Numbers.Web.dll
		
WORKDIR /app
COPY --from=builder /out/ .
```
- CMD 인스트럭션은 컨테이너를 실행할 때 실행됩니다.
- && 은 앞에 오는 명령이 성공하면 뒤에 오는 명령을 실행합니다.
- && 명령 앞의 선행조건을 통해 애플리케이션 실행 조건을 구현합니다.
- 조건에 실패할 경우 컨테이너는 그대로 종료됩니다.

## 핵심 정리
- 디펜던시 체크는 여러 컨테이너 간 의존성을 보장하여, 선행 서비스가 준비될 때까지 본 서비스 실행을 지연시키게 됩니다.
- 의존 서비스가 준비되지 않으면 연결 실패, 재시작 루프 등 장애가 발생할 수 있으니 유의하여야 합니다.

## 퀴즈
### Q1. 다음 중 디펜던시 체크의 목적은?
- A) 컨테이너 자동 삭제
- B) 서비스 간 의존성 보장
- C) 로그 출력 조절
- D) 컨테이너 이름 변경

<details>
<summary>정답 보기</summary>
<b>정답: B) 서비스 간 의존성 보장</b><br>
디펜던시 체크는 선행 서비스가 준비될 때까지 대기하여 의존성을 보장합니다.
</details>

### Q2. depends_on의 한계점으로 옳지 않은 것은?
A) 단순히 시작 순서만 조정할 뿐, 서비스의 준비 상태는 확인하지 않습니다.
B) 서비스의 완전한 가동(healthy 상태)을 보장하지 않습니다.
C) 추가적인 대기 스크립트나 헬스체크 기능이 필요할 수 있습니다.
D) depends_on만 사용해도 모든 서비스가 완전히 준비될 때까지 자동으로 대기합니다.

<details>
<summary>정답 보기</summary>
<b>정답: D) depends_on만 사용해도 모든 서비스가 완전히 준비될 때까지 자동으로 대기합니다.</b><br>
depends_on은 단순히 컨테이너의 실행 순서만 지정할 뿐, 각 서비스가 실제로 준비(healthy)됐는지까지는 확인하지 않습니다.
따라서 D는 잘못된 설명이며, 실제로는 추가적인 대기 스크립트나 헬스체크가 필요합니다.
</details>