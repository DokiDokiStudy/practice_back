---
title: "4.6 연습 문제"
categoryPath:
  - "Docker"
  - "4장 애플리케이션 소스 코드에서 도커 이미지까지"
  - "4.6 연습 문제"
authorNick: "관리자"
createdAt: "2025-08-27"
updateMode: "upsert"
---

# 4.6 연습 문제

4장의 연습 문제를 풀어 볼 시간이다. 이번 장에서 배운 멀티 스테이지 빌드와 Dockerfile 스크립트의 최적화를 연습해 보자. 

책의 소스 코드에서 `ch04/lab` 디렉터리를 먼저 살펴보겠다. 이 디렉터리에는 Go로 구현된 간단한 웹 서버 애플리케이션과 이를 위한 Dockerfile 스크립트가 있다. 그러나 이 빌드 스크립트는 최적화가 필요한 상태다. 

여러분이 해결해야 할 문제는 다음과 같다:

## 연습 문제 목록

### 문제 1: 현재 이미지 빌드 및 최적화

• **지금 있는 Dockerfile 스크립트로 이미지를 빌드한다. 이어서 Dockerfile 스크립트를 최적화한 다음 새로운 이미지를 빌드하라.**

### 문제 2: 이미지 크기 최적화

• **현재 이미지는 리눅스 환경에서 약 800MB, 윈도 환경에서 약 5.2GB 크기다. 최적화된 이미지의 크기가 리눅스 환경에서 약 15MB, 윈도 환경에서 약 260MB가 되도록 하라.**

### 문제 3: 빌드 캐시 최적화

• **현재 Dockerfile 스크립트에 포함된 HTML 파일의 내용을 수정하면 일곱 단계의 빌드 단계를 재수행한다.**

• **Dockerfile 스크립트를 최적화해서 HTML 파일을 수정하더라도 재수행하는 빌드 단계가 한 단계가 되도록 하라.**

---

## 힌트

이번 장의 연습 문제 역시 이 책의 깃허브 저장소에서 해답을 볼 수 있다. 그러나 이번 장의 연습 문제는 꼭 직접 풀어 보기를 권한다. Dockerfile 스크립트 최적화는 모든 프로젝트에서 활용할 수 있는 중요한 기술이기 때문이다. 

그러나 꼭 해답을 참고하고 싶다면, 깃허브 저장소 `ch04/lab/` 폴더에서 볼 수 있다. 이번 장의 연습 문제는 힌트가 없다. 다만, 연습 문제에 나오는 애플리케이션이 이번 장에서 우리가 살펴본 애플리케이션과 비슷하다는 점을 잘 활용하기 바란다.

---

## 실습 가이드

### 1단계: 현재 상태 확인

```bash
# 현재 디렉터리 이동
cd ch04/lab

# 파일 구조 확인
ls -la

# Dockerfile 내용 확인
cat Dockerfile

# 현재 이미지 빌드
docker build -t lab-app:before .

# 이미지 크기 확인
docker images lab-app:before
```

### 2단계: 최적화 전략 수립

현재 Dockerfile을 분석하고 다음 최적화 기법들을 적용해보자:

#### 이미지 크기 최적화
- 멀티 스테이지 빌드 적용
- 경량 베이스 이미지 사용 (alpine)
- 불필요한 파일 제거
- Go 바이너리 정적 링크

#### 빌드 캐시 최적화  
- 자주 변경되지 않는 레이어를 먼저 배치
- 소스 코드와 의존성 분리
- HTML 파일을 별도 레이어로 관리

### 3단계: 최적화된 Dockerfile 작성

```dockerfile
# 최적화 예시 (실제 답안은 직접 작성해보세요!)

# 빌드 스테이지
FROM golang:alpine AS builder
WORKDIR /app

# Go 모듈 파일만 먼저 복사 (캐시 최적화)
COPY go.mod go.sum ./
RUN go mod download

# 소스 코드 복사 및 빌드
COPY . .
RUN CGO_ENABLED=0 GOOS=linux go build -o main .

# 프로덕션 스테이지  
FROM alpine:latest
RUN apk --no-cache add ca-certificates
WORKDIR /root/

# 빌드된 바이너리만 복사
COPY --from=builder /app/main .

# HTML 파일은 별도로 복사 (캐시 최적화)
COPY static/ ./static/

CMD ["./main"]
```

### 4단계: 결과 검증

```bash
# 최적화된 이미지 빌드
docker build -t lab-app:after .

# 크기 비교
docker images | grep lab-app

# 기능 테스트
docker run -p 8080:8080 lab-app:after

# HTML 파일 수정 후 재빌드 테스트
echo "수정된 내용" >> static/index.html
docker build -t lab-app:cache-test .
```

---

## 평가 기준

### 성공 조건
- [ ] 이미지 크기가 800MB → 15MB 이하로 감소
- [ ] 멀티 스테이지 빌드 적용
- [ ] HTML 파일 수정 시 빌드 단계가 1개만 재수행
- [ ] 애플리케이션이 정상 동작
- [ ] Go 바이너리가 정적으로 링크됨

### 최적화 지표

| 항목 | 최적화 전 | 목표 | 달성도 |
|------|-----------|------|--------|
| **이미지 크기** | 800MB | 15MB | ___MB |
| **빌드 단계** | 7단계 재수행 | 1단계 재수행 | ___단계 |
| **빌드 시간** | ___분 | ___분 | ___분 |
| **시작 시간** | ___초 | ___초 | ___초 |
