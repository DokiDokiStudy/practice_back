---
title: '이미지 레이어 캐시를 이용한 Dockerfile 스크립트 최적화'
categoryPath:
  - 'Docker'
  - '3장 도커 이미지 만들기'
  - '3.5 이미지 레이어 캐시를 이용한 Dockerfile 스크립트 최적화'
authorNick: '관리자'
createdAt: '2025-08-10'
updateMode: 'upsert'
---

# 이미지 레이어 캐시를 이용한 Dockerfile 스크립트 최적화

도커의 이미지 레이어는 순차적으로 쌓이게 되고, 중간에 레이어가 변경되면 변경된 레이어보다 위에 오는 레이어를 재사용할 수 없습니다.

```
docker image build -t web-ping:v2 .
...
=> CACHED [stage-1 2/6] WORKDIR /app
=> CACHED [stage-1 3/6] COPY --from=build /app/dist ./dist
=> CACHED [stage-1 4/6] COPY --from=build /app/node_modules ./node_modules
...
```

앞에서 설명했던대로 Dockerfile 스크립트의 인스트럭션은 하나의 이미지와 1:1 관계로 맺어지는데 이 인스트럭션의 결과가 같다면 이미지를 재사용합니다. 이런 방식으로 동일한 인스트럭션을 다시 실행하는 낭비를 줄일 수 있습니다.

> 다만 변경된 레이어 이후에는 레이어를 재사용할 수 없기 때문에 새롭게 실행됩니다.

## Docker 스크립트 개선

web-ping 이미지의 Docker 스크립트에도 개선할 점이 있습니다. ``CMD``인스트럭션은 굳이 마지막에 위치할 필요가 없기에 초반부에 배치하고 ``ENV``인스트럭션  "\" 를 사용하여 여러개의 인스트럭션을 한개로 합칠 수 있습니다.

> 이렇게 수정된 스크립트를 통해 이미지 빌드시 마지막 단계를 제외하고 모든 레이어를 재사용하는데, 이런식으로 최적화를 시킬 수 있습니다.
