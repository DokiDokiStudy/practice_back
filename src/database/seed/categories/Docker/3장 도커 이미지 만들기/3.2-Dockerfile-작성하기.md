---
title: '3.2 Dockerfile 작성하기'
categoryPath:
  - 'Docker'
  - '3장 도커 이미지 만들기'
  - '3.2 Dockerfile 작성하기'
authorNick: '관리자'
createdAt: '2025-08-27'
updateMode: 'upsert'
---

# 3.2 Dockerfile 작성하기

Dockerfile은 애플리케이션을 패키징하기 위한 간단한 스크립트입니다.  
일련의 인스트럭션으로 구성되어 있는데, 인스트럭션을 실행한 결과로 도커 이미지가 만들어집니다.

앞선 3-1 예제의 도커파일은 다음과 같습니다:

```dockerfile
FROM diamol/node
ENV TARGET="blog.sixeyed.com"
ENV METHOD="HEAD"
ENV INTERVAL="3000"
WORKDIR /web-ping
COPY app.js .
CMD ["node", "/web-ping/app.js"]
```

각 인스트럭션이 무엇을 하는지 하나씩 살펴보겠습니다.

<br/>

## 📋 주요 Dockerfile 인스트럭션

### 1. FROM: 베이스 이미지 지정

```dockerfile
FROM diamol/node
```

**모든 이미지는 다른 이미지로부터 출발합니다.**

이 이미지는 `diamol/node` 이미지를 시작점으로 지정합니다.  
`diamol/node`에는 Node.js가 설치되어 있습니다.

FROM은 항상 Dockerfile의 첫 번째 인스트럭션이어야 합니다.  
베이스 이미지는 우리가 만들 이미지의 기반이 되는 운영체제와 런타임 환경을 제공합니다.

**다른 예시들:**

```dockerfile
FROM ubuntu:22.04        # Ubuntu 운영체제
FROM python:3.11         # Python 런타임 환경
FROM node:18-alpine      # Node.js + 경량 Alpine Linux
FROM nginx:1.23          # Nginx 웹서버
```

### 2. ENV: 환경 변수 설정

```dockerfile
ENV TARGET="blog.sixeyed.com"
ENV METHOD="HEAD"
ENV INTERVAL="3000"
```

**환경 변수 값을 지정하기 위한 인스트럭션**으로 키=값 형식을 따릅니다.

- `TARGET`: 핑을 보낼 대상 웹사이트
- `METHOD`: HTTP 요청 방식
- `INTERVAL`: 핑을 보내는 간격 (밀리초)

💡 **왜 환경변수를 사용할까요?**

<details>
<summary><strong>👆 클릭해서 확인하기</strong></summary>

환경변수를 사용하면:

- **유연성**: 같은 이미지로 다른 설정의 컨테이너 실행 가능
- **보안**: 비밀번호 같은 민감한 정보를 코드에 직접 넣지 않음
- **재사용성**: 다양한 환경(개발/테스트/운영)에서 같은 이미지 활용

```bash
# 다른 설정으로 같은 이미지 사용
docker run --env TARGET=google.com my-app
docker run --env TARGET=naver.com my-app
```

</details>

### 3. WORKDIR: 작업 디렉터리 설정

```dockerfile
WORKDIR /web-ping
```

**컨테이너 이미지 파일 시스템에 디렉터리를 만들고, 해당 디렉터리를 작업 디렉터리로 지정**하는 인스트럭션입니다.  
이후의 모든 명령은 이 디렉터리를 기준으로 실행됩니다.

```dockerfile
WORKDIR /app
COPY . .          # /app 디렉터리에 파일들이 복사됨
RUN npm install   # /app 디렉터리에서 실행됨
```

### 4. COPY: 파일 복사

```dockerfile
COPY app.js .
```

**로컬 파일 시스템의 파일, 디렉터리를 컨테이너 이미지로 복사**하는 인스트럭션입니다.  
`원본경로 복사경로` 형식으로 지정합니다.

- `app.js`: 현재 디렉터리의 app.js 파일
- `.`: 현재 작업 디렉터리(/web-ping)로 복사

**다양한 COPY 사용법:**

```dockerfile
COPY app.js /app/                    # 파일 하나 복사
COPY package*.json ./                # 패턴 매칭으로 여러 파일
COPY src/ /app/src/                  # 디렉터리 전체 복사
COPY . .                             # 현재 디렉터리 모든 파일 복사
```

### 5. CMD: 기본 실행 명령

```dockerfile
CMD ["node", "/web-ping/app.js"]
```

**도커가 이미지로부터 컨테이너를 실행했을 때 실행할 명령을 지정**하는 인스트럭션입니다.  
JSON 배열 형식으로 작성합니다.

```dockerfile
CMD ["python", "app.py"]       # Python 애플리케이션 실행
CMD ["npm", "start"]           # Node.js 애플리케이션 실행
CMD ["java", "-jar", "app.jar"] # Java 애플리케이션 실행
```

<br/>

## 🏷️ 주요 태그와 용어 정리

### Dockerfile 인스트럭션

| 인스트럭션 | 설명                  | 예시                        |
| ---------- | --------------------- | --------------------------- |
| `FROM`     | 베이스 이미지 지정    | `FROM node:18-alpine`       |
| `ENV`      | 환경변수 설정         | `ENV PORT=3000`             |
| `WORKDIR`  | 작업 디렉터리 설정    | `WORKDIR /app`              |
| `COPY`     | 파일/디렉터리 복사    | `COPY . .`                  |
| `RUN`      | 명령어 실행 (빌드 시) | `RUN npm install`           |
| `CMD`      | 기본 실행 명령        | `CMD ["node", "server.js"]` |
| `EXPOSE`   | 포트 노출             | `EXPOSE 3000`               |

### 주요 용어

- **베이스 이미지**: 새로운 이미지의 기반이 되는 이미지
- **레이어**: Dockerfile의 각 인스트럭션이 만드는 이미지 층
- **빌드 컨텍스트**: `docker build` 실행 시 도커 데몬으로 전송되는 파일들
- **태그**: 이미지에 붙이는 이름표 (예: `my-app:latest`)

<br/>

## 🎮 연습 문제

**문제 1:** Express.js 웹 애플리케이션을 위한 Dockerfile에서 베이스 이미지를 지정하는 인스트럭션을 작성하세요.

<details>
<summary><strong>정답 보기</strong></summary>

```dockerfile
FROM node:18-alpine
```

</details>
<br/>

**문제 2:** 작업 디렉터리를 `/app`으로 설정하고, `package.json` 파일을 복사하는 인스트럭션을 작성하세요.

<details>
<summary><strong>정답 보기</strong></summary>

```dockerfile
WORKDIR /app
COPY package.json .
```

</details>
<br/>

**문제 3:** 환경변수 `NODE_ENV=production`을 설정하고, Node.js 애플리케이션을 실행하는 CMD 인스트럭션을 작성하세요.

<details>

<summary><strong>정답 보기</strong></summary>

```dockerfile
ENV NODE_ENV=production
CMD ["node", "server.js"]
```

</details>
<br/>
<details>

<summary><strong>🔍 Dockerfile 최적화 팁</strong></summary>

### 1. 효율적인 레이어 구성

```dockerfile
# 의존성 파일을 먼저 복사해서 캐시 활용
COPY package*.json ./
RUN npm install

# 소스 코드는 나중에 복사
COPY . .
```

### 2. .dockerignore 파일 사용

```bash
# .dockerignore 파일로 불필요한 파일 제외
node_modules
.git
.env
*.log
```

### 3. 멀티 스테이지 빌드

```dockerfile
# 빌드 스테이지
FROM node:18 AS builder
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build

# 실행 스테이지
FROM node:18-alpine
WORKDIR /app
COPY --from=builder /app/dist ./dist
CMD ["node", "dist/server.js"]
```

### 4. 경량 베이스 이미지 사용

```dockerfile
FROM node:18-alpine    # alpine 버전 (더 작음)
FROM python:3.11-slim  # slim 버전 (중간 크기)
```

</details>
