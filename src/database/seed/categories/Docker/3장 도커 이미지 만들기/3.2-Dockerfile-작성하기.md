---
title: "3.2 Dockerfile 작성하기"
categoryPath:
  - "Docker"
  - "3장 도커 이미지 만들기"
  - "3.2 Dockerfile 작성하기"
authorNick: "관리자"
createdAt: "2025-08-27"
updateMode: "upsert"
---

Dockerfile은 Docker 이미지를 자동으로 빌드하기 위한 텍스트 파일입니다. 이미지 생성 과정을 코드로 정의하여 재현 가능하고 버전 관리가 가능한 이미지를 만들 수 있습니다.

## Dockerfile 기본 구조

### 필수 지시어들

#### FROM - 베이스 이미지 지정
```dockerfile
# 공식 이미지 사용
FROM ubuntu:22.04

# 경량 이미지 사용
FROM alpine:3.19

# 언어 런타임 사용
FROM node:18-alpine
FROM python:3.11-slim
```

#### RUN - 명령어 실행
```dockerfile
# 패키지 설치
RUN apt-get update && apt-get install -y \
    curl \
    wget \
    && rm -rf /var/lib/apt/lists/*

# Alpine에서 패키지 설치
RUN apk add --no-cache nodejs npm
```

#### COPY vs ADD - 파일 복사
```dockerfile
# 로컬 파일을 컨테이너로 복사
COPY app.js /app/
COPY package.json package-lock.json /app/

# 디렉토리 전체 복사
COPY . /app/

# ADD는 압축 해제, URL 다운로드 지원 (일반적으로 COPY 권장)
ADD https://example.com/file.tar.gz /tmp/
```

#### WORKDIR - 작업 디렉토리 설정
```dockerfile
WORKDIR /app
# 이후 모든 명령어는 /app 디렉토리에서 실행
```

#### CMD vs ENTRYPOINT - 실행 명령
```dockerfile
# CMD: 컨테이너 시작 시 기본 명령어
CMD ["python", "app.py"]

# ENTRYPOINT: 항상 실행되는 명령어
ENTRYPOINT ["python", "app.py"]

# 함께 사용: ENTRYPOINT + CMD
ENTRYPOINT ["python"]
CMD ["app.py"]
```

## 실습: 간단한 웹 애플리케이션 이미지 만들기

### 1. Node.js 앱 준비
```bash
mkdir my-web-app
cd my-web-app

# package.json 생성
cat > package.json << EOF
{
  "name": "my-web-app",
  "version": "1.0.0",
  "main": "server.js",
  "dependencies": {
    "express": "^4.18.0"
  }
}
EOF

# 서버 코드 작성
cat > server.js << EOF
const express = require('express');
const app = express();
const PORT = 3000;

app.get('/', (req, res) => {
  res.send('<h1>Hello Docker!</h1><p>이 앱은 Docker 컨테이너에서 실행중입니다.</p>');
});

app.listen(PORT, () => {
  console.log(\`Server running on port \${PORT}\`);
});
EOF
```

### 2. Dockerfile 작성
```dockerfile
# Node.js 공식 이미지 사용
FROM node:18-alpine

# 작업 디렉토리 설정
WORKDIR /app

# package.json 먼저 복사 (캐시 최적화)
COPY package*.json ./

# 의존성 설치
RUN npm install

# 애플리케이션 코드 복사
COPY . .

# 포트 노출
EXPOSE 3000

# 애플리케이션 실행
CMD ["node", "server.js"]
```

### 3. 이미지 빌드 및 실행
```bash
# 이미지 빌드
docker build -t my-web-app .

# 컨테이너 실행
docker run -p 3000:3000 my-web-app

# 브라우저에서 http://localhost:3000 접속
```

## 고급 Dockerfile 기법

### 환경 변수 설정
```dockerfile
# 환경 변수 정의
ENV NODE_ENV=production
ENV PORT=3000

# 런타임에 환경 변수 사용
CMD ["sh", "-c", "node server.js --port=$PORT"]
```

### 볼륨 마운트 포인트 설정
```dockerfile
# 데이터 볼륨 지정
VOLUME ["/data"]
```

### 사용자 설정 (보안 강화)
```dockerfile
# 비-root 사용자 생성
RUN addgroup -g 1001 -S nodejs
RUN adduser -S nextjs -u 1001

# 사용자 전환
USER nextjs
```

### 헬스 체크 설정
```dockerfile
# 컨테이너 상태 체크
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD curl -f http://localhost:3000/ || exit 1
```

## Dockerfile 최적화 팁

### 1. 레이어 최소화
```dockerfile
# 비효율적 (여러 레이어)
RUN apt-get update
RUN apt-get install -y curl
RUN apt-get install -y wget

# 효율적 (단일 레이어)
RUN apt-get update && \
    apt-get install -y curl wget && \
    rm -rf /var/lib/apt/lists/*
```

### 2. 캐시 활용
```dockerfile
# package.json을 먼저 복사하여 의존성 캐시 활용
COPY package*.json ./
RUN npm install

# 소스 코드는 나중에 복사
COPY . .
```

### 3. .dockerignore 사용
```bash
# .dockerignore 파일 생성
cat > .dockerignore << EOF
node_modules
npm-debug.log
.git
.gitignore
README.md
.env
.nyc_output
coverage
.tmp
EOF
```

## 다양한 언어별 Dockerfile 예제

### Python Flask 앱
```dockerfile
FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

EXPOSE 5000

CMD ["python", "app.py"]
```

### Java Spring Boot 앱
```dockerfile
FROM openjdk:17-jre-slim

WORKDIR /app

COPY target/myapp.jar app.jar

EXPOSE 8080

CMD ["java", "-jar", "app.jar"]
```

### Go 애플리케이션
```dockerfile
# 멀티 스테이지 빌드 사용
FROM golang:1.19 AS builder

WORKDIR /app
COPY . .
RUN CGO_ENABLED=0 GOOS=linux go build -o main .

FROM alpine:latest
RUN apk --no-cache add ca-certificates
WORKDIR /root/

COPY --from=builder /app/main .

CMD ["./main"]
```

## 베스트 프랙티스

### 1. 보안
- 최소 권한 원칙 적용
- 비-root 사용자 사용
- 불필요한 패키지 설치 금지
- 최신 베이스 이미지 사용

### 2. 성능
- 경량 베이스 이미지 사용 (Alpine)
- 멀티 스테이지 빌드 활용
- 불필요한 파일 제외 (.dockerignore)

### 3. 유지보수
- 명확한 레이블 추가
- 버전 태그 명시
- 문서화 및 주석

이제 Dockerfile 작성의 기본을 익혔습니다. 다음에서는 실제로 이미지를 빌드하는 방법을 학습하겠습니다!