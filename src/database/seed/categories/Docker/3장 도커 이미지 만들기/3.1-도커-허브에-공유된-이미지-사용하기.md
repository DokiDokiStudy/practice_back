# 3.1 도커 허브에 공유된 이미지 사용하기

2장에서 `docker container run` 명령을 사용할 때 필요한 이미지 중 로컬 컴퓨터에 없는 이미지가 있으면 이미지를 내려받았습니다.  
이미지를 내려받는 과정을 저번과 같이 도커에 전적으로 맡길 수도 있지만, 도커 CLI를 통해 명시적으로 원하는 이미지를 내려받을 수도 있습니다.

지정한 웹사이트가 정상적으로 작동하는지 확인하는 컨테이너를 실행해보겠습니다.  
이 앱은 **3초마다 HTTP 요청을 보내서** 응답 시간을 측정합니다.

### 1단계: 이미지 다운로드

```bash
# 이미지를 명시적으로 다운로드
docker image pull diamol/ch03-web-ping
```

**실행 결과:**

```
Using default tag: latest
latest: Pulling from diamol/ch03-web-ping
0362ad1dd800: Already exists
b09a182c47e8: Already exists
39d61d2ed871: Already exists
b4e2115e274a: Already exists
f5cca017994f: Pull complete
f504555623f6: Pull complete
```

💡 **왜 여러 파일이 동시에 다운로드될까요?**

<details>
<summary><strong>👆 클릭해서 확인하기</strong></summary>
도커 이미지는 <strong>여러 개의 레이어(층)</strong>으로 구성되어 있습니다.

- 각 레이어는 작은 파일 조각
- 도커가 이 레이어들을 조립해서 완전한 파일 시스템을 만듦
- 이미 다운로드된 레이어는 재사용 (`Already exists`)
- 새로운 레이어만 다운로드 (`Pull complete`)

이 구조 덕분에 용량을 절약하고 다운로드 속도가 빨라집니다!  
이 개념은 다음장에 추가로 학습합니다.

</details>

### 2단계: 백그라운드에서 컨테이너 실행

```bash
# -d 옵션으로 백그라운드 실행, --name으로 web-ping이라는 컨테이너명 지정
docker container run -d --name web-ping diamol/ch03-web-ping
```

### 3단계: 로그 확인하기

```bash
# 컨테이너의 출력 로그 보기
docker container logs web-ping
```

**로그 출력 예시:**

```
** web-ping ** Pinging: blog.sixeyed.com; method: HEAD; 3000ms intervals
Making request number: 1; at 1758642880851
Got response status: 200 at 1758642880972; duration: 121ms
Making request number: 2; at 1758642883868
Got response status: 200 at 1758642883879; duration: 11ms
Making request number: 3; at 1758642886874
Got response status: 200 at 1758642886884; duration: 10ms
```

3초마다 웹사이트에 요청을 보내고 응답시간을 측정하고 있습니다.

<br/>

## 🔧 환경변수로 설정 변경하기

현재는 기본 설정으로 `blog.sixeyed.com`을 모니터링하고 있습니다.  
**환경변수**를 사용해서 다른 웹사이트를 모니터링해보겠습니다.

### 환경변수란?

**환경변수**는 운영체제에서 제공하는 **키-값 쌍**입니다:

- 작은 설정값들을 저장하는데 유용
- 컨테이너마다 독립적인 환경변수를 가짐
- 호스트 컴퓨터의 환경변수와는 별개

```bash
# 기존 컨테이너 제거
docker rm -f web-ping

# 환경변수로 TARGET을 google.com으로 설정
docker container run --env TARGET=google.com diamol/ch03-web-ping
```

**결과:**

```
** web-ping ** Pinging: google.com; method: HEAD; 3000ms intervals
Making request number: 1; at 1758643251025
Got response status: 301 at 1758643251419; duration: 394ms
Making request number: 2; at 1758643254027
Got response status: 301 at 1758643254307; duration: 280ms
```

이렇게 같은 이미지로 다른 설정의 컨테이너를 만들 수 있습니다!

<br/>

## 🏷️ 주요 태그와 용어 정리

### 도커 명령어

| 명령어                        | 설명                             | 예시                             |
| ----------------------------- | -------------------------------- | -------------------------------- |
| `docker image pull`           | 이미지를 레지스트리에서 다운로드 | `docker image pull nginx`        |
| `docker container run -d`     | 백그라운드에서 컨테이너 실행     | `docker run -d nginx`            |
| `docker container run --name` | 컨테이너에 이름 지정             | `docker run --name my-app nginx` |
| `docker container run --env`  | 환경변수 설정                    | `docker run --env PORT=8080 app` |
| `docker container logs`       | 컨테이너 로그 확인               | `docker logs my-app`             |
| `docker rm -f`                | 컨테이너 강제 삭제               | `docker rm -f my-app`            |

### 핵심 개념

- **레지스트리(Registry)**: 도커 이미지를 저장하는 저장소 (도커 허브가 기본)
- **도커 허브**: 전 세계 최대 공개 도커 이미지 저장소
- **이미지 레이어**: 도커 이미지를 구성하는 작은 파일 조각들
- **환경변수**: 컨테이너 설정을 동적으로 변경할 수 있는 키-값 쌍

## 🎮 연습 문제

**문제 1:** `nginx` 이미지를 다운로드하세요.

<details>
<summary><strong>정답 보기</strong></summary>

```bash
docker image pull nginx
```

</details>
<br/>

**문제 2:** `nginx` 이미지로 컨테이너명을 `my-web`으로 지정해서 실행하세요.

<details>
<summary><strong>정답 보기</strong></summary>

```bash
docker container run -d --name my-web nginx
```

</details>
<br/>

**문제 3:** `diamol/ch03-web-ping` 이미지로 `naver.com`을 모니터링하는 컨테이너를 만드세요.

<details>
<summary><strong>정답 보기</strong></summary>

```bash
docker container run --env TARGET=naver.com diamol/ch03-web-ping
```

</details>
<br/>
<details>
<summary><strong>🔍 도커 허브 더 알아보기</strong></summary>

### 도커 허브의 특징

- **무료 공개 레지스트리**: 누구나 이미지를 업로드하고 다운로드 가능
- **공식 이미지**: Docker와 소프트웨어 제작사가 검증한 이미지
- **커뮤니티 이미지**: 개발자들이 공유한 이미지
- **자동 빌드**: GitHub과 연동해서 코드 변경시 자동으로 이미지 빌드

### 이미지 검색하기

```bash
# Redis 관련 이미지 검색
docker search redis
```

### 주요 공식 이미지들

```bash
# 운영체제
docker pull ubuntu:22.04
docker pull alpine        # 초경량 리눅스 (5MB)

# 프로그래밍 언어
docker pull python:3.11
docker pull node:18
docker pull openjdk:11

# 데이터베이스
docker pull mysql:8.0
docker pull postgres:15
docker pull redis:7.0

# 웹서버
docker pull nginx:1.23
docker pull httpd:2.4     # Apache
```

### 태그 시스템

```bash
docker pull redis:latest    # 최신 버전 (권장하지 않음)
docker pull redis:7.0       # 특정 버전 (권장)
docker pull redis:7.0-alpine # Alpine Linux 기반
```

</details>
