---
title: "3.3 컨테이너 이미지 빌드하기"
categoryPath:
  - "Docker"
  - "3장 도커 이미지 만들기"
  - "3.3 컨테이너 이미지 빌드하기"
authorNick: "관리자"
createdAt: "2025-08-27"
updateMode: "upsert"
---

Dockerfile을 작성했다면 이제 실제 이미지로 빌드해야 합니다. `docker build` 명령어를 사용하여 Dockerfile로부터 이미지를 생성하는 과정을 상세히 알아보겠습니다.

## 기본 빌드 명령어

### 가장 간단한 빌드
```bash
# 현재 디렉토리의 Dockerfile을 사용하여 이미지 빌드
docker build -t myapp .

# 빌드 후 컨테이너 실행
docker run -d -p 8080:80 myapp
```

### 주요 옵션 설명
- **-t (--tag)**: 이미지에 태그(이름) 지정
- **.**: 현재 디렉토리를 빌드 컨텍스트로 사용
- **-f (--file)**: 특정 Dockerfile 파일 지정

## 실습: 단계별 이미지 빌드

### 1. 간단한 웹사이트 프로젝트
```bash
mkdir my-website-build
cd my-website-build

# HTML 파일 생성
cat > index.html << EOF
<!DOCTYPE html>
<html>
<head>
    <title>My Docker Website</title>
    <style>
        body { font-family: Arial; text-align: center; padding: 50px; }
        h1 { color: #2196F3; }
    </style>
</head>
<body>
    <h1>Docker로 빌드한 웹사이트</h1>
    <p>이 페이지는 직접 빌드한 Docker 이미지에서 실행됩니다!</p>
</body>
</html>
EOF

# Dockerfile 생성
cat > Dockerfile << EOF
FROM nginx:alpine
COPY index.html /usr/share/nginx/html/
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
EOF
```

### 2. 이미지 빌드 실행
```bash
# 이미지 빌드
docker build -t my-website:v1.0 .

# 빌드 결과 확인
docker images my-website

# 컨테이너 실행
docker run -d --name my-site -p 8080:80 my-website:v1.0

# 브라우저에서 http://localhost:8080 확인
```

## 태그 관리 전략

### 버전별 태그
```bash
# 다양한 태그 방식
docker build -t myapp:v1.0 .
docker build -t myapp:latest .
docker build -t myapp:$(date +%Y%m%d) .
docker build -t myapp:$(git rev-parse --short HEAD) .
```

### 환경별 태그
```bash
docker build -t myapp:dev .
docker build -t myapp:staging .
docker build -t myapp:prod .
```

## 빌드 최적화

### .dockerignore 활용
```bash
# 불필요한 파일 제외
cat > .dockerignore << EOF
node_modules/
.git/
*.log
.tmp/
coverage/
EOF
```

### 레이어 캐싱 최적화
```dockerfile
# 의존성 파일을 먼저 복사하여 캐시 활용
COPY package*.json ./
RUN npm install

# 소스 코드는 나중에 복사
COPY . .
```

## 실습: Node.js 애플리케이션 빌드

### 1. 프로젝트 준비
```bash
mkdir node-app-build
cd node-app-build

# package.json 생성
cat > package.json << EOF
{
  "name": "docker-node-app",
  "version": "1.0.0",
  "main": "server.js",
  "dependencies": {
    "express": "^4.18.2"
  }
}
EOF

# 서버 코드 생성
cat > server.js << EOF
const express = require('express');
const app = express();
const PORT = 3000;

app.get('/', (req, res) => {
    res.json({
        message: 'Docker로 빌드된 Node.js 앱입니다!',
        timestamp: new Date().toISOString(),
        nodeVersion: process.version
    });
});

app.listen(PORT, () => {
    console.log(\`서버가 포트 \${PORT}에서 실행 중입니다!\`);
});
EOF
```

### 2. 최적화된 Dockerfile
```dockerfile
FROM node:18-alpine

# 작업 디렉토리 설정
WORKDIR /app

# 의존성 파일 먼저 복사 (캐시 최적화)
COPY package*.json ./

# 의존성 설치
RUN npm ci --only=production

# 소스 코드 복사
COPY . .

# 비-root 사용자 생성 (보안)
RUN addgroup -g 1001 -S nodejs && \
    adduser -S nodejs -u 1001
USER nodejs

# 포트 노출
EXPOSE 3000

# 애플리케이션 실행
CMD ["npm", "start"]
```

### 3. 빌드 및 실행
```bash
# 이미지 빌드
docker build -t node-app:v1.0 .

# 컨테이너 실행
docker run -d --name my-node-app -p 3000:3000 node-app:v1.0

# API 테스트
curl http://localhost:3000
```

## 빌드 문제 해결

### 일반적인 오류들
```bash
# 1. 컨텍스트 크기 문제
# 해결: .dockerignore로 큰 파일 제외

# 2. 파일을 찾을 수 없음
# 해결: 빌드 컨텍스트 내 파일 위치 확인

# 3. 권한 문제
# 해결: Dockerfile에서 적절한 권한 설정
```

### 빌드 성능 향상
```bash
# 캐시 없이 전체 재빌드
docker build --no-cache -t myapp .

# 빌드 과정 상세 출력
docker build --progress=plain -t myapp .

# 빌드 시간 측정
time docker build -t myapp .
```

## 빌드 결과 검증

### 이미지 정보 확인
```bash
# 이미지 목록
docker images

# 상세 정보
docker inspect myapp:v1.0

# 히스토리 (레이어별 명령어)
docker history myapp:v1.0

# 이미지 크기 확인
docker system df
```

## 멀티 스테이지 빌드 미리보기

### 크기 최적화 예제
```dockerfile
# 빌드 스테이지
FROM node:18 AS builder
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build

# 프로덕션 스테이지
FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
```

이제 Docker 이미지 빌드의 핵심을 완전히 이해했습니다! 다음 섹션에서는 이미지 레이어와 고급 최적화 기법을 알아보겠습니다.