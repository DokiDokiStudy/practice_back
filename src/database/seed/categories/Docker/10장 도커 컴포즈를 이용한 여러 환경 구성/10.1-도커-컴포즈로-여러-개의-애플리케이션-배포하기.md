---
title: "10.1 도커 컴포즈로 여러 개의 애플리케이션 배포하기"
categoryPath:
  - "Docker"
  - "10장 도커 컴포즈를 이용한 여러 환경 구성"
  - "10.1 도커 컴포즈로 여러 개의 애플리케이션 배포하기"
authorNick: "관리자"
createdAt: "2025-08-27"
updateMode: "upsert"
---

# 10.1 도커 컴포즈로 여러 개의 애플리케이션 배포하기

- 배포가 실패하는 주된 원인은 환경 차이를 뽑을 수 있습니다.
- 도커는 패키지에 모든 의존 모듈이 함께 들어가기 떄문에 해당 문제를 해결할 수 있습니다.
- 하지만, 환경에따라 동작을 다르게 해야 할 필요가 있습니다.
- 도커 컴포즈의 고급 기능을 사용하여 이를 해결할 수 있습니다.
- 도커 컴포즈 파일에서 해당 구성을 명시해야 합니다.
- 도커 컴포즈 파일은 레이블 명명 규칙을 통해 도커 리소스를 컨테이너와 서비스로 구분하며 관리합니다.

## 도커 컴포즈 리소스 이름 규칙
- 도커 컴포즈 파일이 위치한 디렉토리의 이름을 기본으로 프로젝트 라고 합니다.
- 프로젝트는 도커 리소스가 어떤 애플리케이션의 일부인지 아닌지를 판별하기 위해 사용됩니다.
- 도커 컴포즈에서 관리하는 모든 객체를 리소스 라고 합니다.
- 여러 개의 도커 컴포즈 프로젝트를 동시에 실행하는 경우, 프로젝트 이름을 접두사로 붙여서 구분합니다.
- 동일한 서비스의 복수 인스턴스를 구분하기 위해 접미사로 증가하는 숫자를 사용합니다.

```bash
# docker compose 가 사용하는 프로제트 이름 변경
$ docker compose -f ./todo-list/docker-compose.yml -p todo-test up -d

$ docker ps

CONTAINER ID   IMAGE                   COMMAND                 CREATED         STATUS         PORTS                                       NAMES
e0645d889591   diamol/ch06-todo-list   "dotnet ToDoList.dll"   2 seconds ago   Up 1 second    0.0.0.0:32776->80/tcp, [::]:32776->80/tcp   todo-test-todo-web-1
290efebd5094   diamol/ch06-todo-list   "dotnet ToDoList.dll"   7 minutes ago   Up 7 minutes   0.0.0.0:32775->80/tcp, [::]:32775->80/tcp   todo-list-todo-web-1

$ docker container port todo-test_todo_web_1 80
```

- 복수 인스턴스를 사용하는 경우 인스턴스 각각의 설정을 찾아서 변경하는 것은 번거롭습니다.
- 매번 컴포즈 파일을 복사하여 수정하는 것은 비효율적이고 관리가 어렵습니다.
- 도커 컴포즈는 설정을 오버라이드하는 기능을 제공하여 위의 문제를 해결합니다.

## 도커 컴포즈 오버라이드 파일
- 하나의 애플리케이션을 여러 설정으로 실행할 필요가 있을 경우, 대부분은 컴포즈 파일을 여러개 정의하여 사용합니다.
- 그러나, 이 방법은 유지보수 측면에서 바람직하지 않습니다.
- 오버라이드 파일을 사용하면 이러한 문제를 해결할 수 있습니다.
- 도커 컴포즈는 여러 파일을 합쳐 컴포즈 파일을 구성하고, 나중에 지정된 파일의 내용이 이전 파일의 내용을 덮어씁니다.


```bash
# docker-compose.yml 기본 파일
$ vi docker-compose.yml
```

```yaml
services:
	todo-web:
		image: diamol/ch06-todo-list
		ports:
			- 80
		environment:
			- Database:Provider=Sqlite
		networks:
			- app-net

```

```bash
# docker-compose-v2.yml 오버라이드 파일
$ vi docker-compose-v2.yml
```

```yaml
services:
	todo-web:
		image: diamol/ch06-todo-list:v2
```

```bash
$ docker compose -f docker-compose.yml -f docker-compose-v2.yml config
```

```yaml
name: todo-list
services:
  todo-web:
    environment:
      Database:Provider: Sqlite
    image: diamol/ch06-todo-list:v2
    networks:
      app-net: null
    ports:
      - mode: ingress
        target: 80
        protocol: tcp
networks:
  app-net:
    name: todo-list_app-net
```
- 두 docker-compose 파일 모두 유효한 도커 컴포즈 파일 형식을 유지해야 합니다.
- 기본이 되는 컴포즈 파일의 구조를 유지해야 도커 컴포즈가 두 정의를 연결할 수 있습니다.
- config 명령어를 통해 병합된 파일의 내용이 유효한지 검사할 수 있습니다.
- 도커 컴포즈가 오버라이드 파일을 병합하는 순서는 인자의 순서를 따릅니다.

```bash
$ docker compose -f docker-compose.yml -f docker-compose-dev.yml -p number-dev up -d
[+] Running 3/3
 ✔ Network numbers-dev                 Created                                                                                                                                                         0.1s 
 ✔ Container number-dev-numbers-web-1  Started                                                                                                                                                         0.3s 
 ✔ Container number-dev-numbers-api-1  Started                                                                                                                                                         0.2s 
$ docker compose -f docker-compose.yml -f docker-compose-test.yml -p number-test up -d
[+] Running 3/3
 ✔ Network numbers-test                 Created                                                                                                                                                        0.1s 
 ✔ Container number-test-numbers-api-1  Started                                                                                                                                                        0.2s 
 ✔ Container number-test-numbers-web-1  Started                                                                                                                                                        0.2s 
$ docker compose -f docker-compose.yml -f docker-compose-uat.yml -p number-uat up -d
[+] Running 3/3
 ✔ Network numbers-uat                 Created                                                                                                                                                         0.1s 
 ✔ Container number-uat-numbers-api-1  Started                                                                                                                                                         0.2s 
 ✔ Container number-uat-numbers-web-1  Started                                                              
 
 $ docker compose -f docker-compose.yml -f docker-compose-test.yml -p number-test down
[+] Running 3/3
 ✔ Container number-test-numbers-api-1  Removed                                                                                                                                                        0.1s 
 ✔ Container number-test-numbers-web-1  Removed                                                                                                                                                       10.2s 
 ✔ Network numbers-test                 Removed    
```

- 환경별로 실행된 컨테이너는 도메인 네임을 사용해 서로를 식별하지만, 같은 도커 네트워크에 접속한 컨테이너끼리만 통신이 가능합니다.
- 오버라이드 파일을 사용하면 애플리케이션 재정의 이점이 존재합니다.
- 그러나, 오버라이드 관리에 드는 오버헤드도 발생합니다.
- 따라서, 오버라이드 파일관련 배포 관련 자동화 구성하여 오버헤드를 최소화 하는것이 좋습니다.

### 운영 환경에서 오버라이드를 활용할 때 생각해볼 점
- 오버라이드 파일은 개발(dev), 테스트(test), 운영(prod) 환경을 하나의 코드 기반으로 관리할 수 있게 해줍니다.
- 다만, 파일 수가 많아질수록 관리 복잡도가 높아지므로, **환경별 변수 관리(.env) + CI/CD 자동화**를 통해 통합 관리하는 것이 바람직합니다.

## 퀴즈

### Q1. 도커 컴포즈에서 프로젝트 이름이 결정되는 기본 기준은?
- A) 서비스 이름
- B) 컨테이너 이름
- C) docker-compose.yml이 위치한 디렉토리 이름
- D) Dockerfile 이름

<details>
<summary>정답 보기</summary>
<b>정답: C) docker-compose.yml이 위치한 디렉토리 이름</b><br>
도커 컴포즈는 기본적으로 현재 디렉토리명을 프로젝트 이름으로 사용합니다.
</details>

### Q2. 도커 컴포즈 오버라이드 파일의 병합 순서는?
- A) 알파벳 순서
- B) 생성일 순서
- C) 파일 정의 순서 (뒤에 지정된 파일이 우선)
- D) 무작위

<details>
<summary>정답 보기</summary>
<b>정답: C) 파일 정의 순서</b><br>
`-f` 옵션으로 지정한 순서대로 병합되며, 나중 파일이 이전 파일을 덮어씁니다.
</details>

### Q3. 오버라이드 파일을 사용하는 주요 목적은?
- A) Dockerfile을 여러 개로 분리하기 위함
- B) 환경별 설정을 재사용하고 관리 효율성을 높이기 위함
- C) 네트워크를 여러 개 만들기 위함
- D) 로그를 분리하기 위함

<details>
<summary>정답 보기</summary>
<b>정답: B) 환경별 설정을 재사용하고 관리 효율성을 높이기 위함</b><br>
오버라이드 파일을 사용하면 개발·테스트·운영 환경별로 다른 설정을 유연하게 관리할 수 있습니다.
</details>