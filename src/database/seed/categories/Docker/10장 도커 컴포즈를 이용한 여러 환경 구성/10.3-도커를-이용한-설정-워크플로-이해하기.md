---
title: "10.3 도커를 이용한 설정 워크플로 이해하기"
categoryPath:
  - "Docker"
  - "10장 도커 컴포즈를 이용한 여러 환경 구성"
  - "10.3 도커를 이용한 설정 워크플로 이해하기"
authorNick: "관리자"
createdAt: "2025-08-27"
updateMode: "upsert"
---

# 10.3 도커를 이용한 설정 워크플로 이해하기
- 도커 설정 워크플로는 "이미지는 그대로, 설정만 다르게"라는 철학을 기반으로 합니다.
- 즉, 도커 환경에서 설정 워크플로(configuration workflow)란, **하나의 이미지를 여러 환경(dev, test, prod)에서 동일하게 재사용하면서, 실행 환경에 따라 다르게 동작하도록 만드는 과정**을 의미합니다.
- 핵심은 **"모든 환경에서 동일한 이미지를 사용하되, 컨테이너 실행 시 주입되는 설정으로 동작을 구분한다."**는 점입니다.

## 애플리케이션 구성 요소의 조합
- 도커 컴포즈는 하나의 애플리케이션을 여러 서비스(web, api, db 등)로 정의하고, 환경별로 다른 설정이 필요한 경우 오버라이드 파일(`docker-compose-dev.yml`, `docker-compose-prod.yml`)을 추가하여 유연하게 조합합니다.
- 즉, 공통 구성은 **기본 compose 파일**에서 정의하고, 환경별 차이는 **오버라이드 파일**에서 덮어쓰는 방식입니다.

```bash
$ docker compose -f docker-compose.yml -f docker-compose-dev.yml -p app-dev up -d
$ docker compose -f docker-compose.yml -f docker-compose-prod.yml -p app-prod up -d
```
- 이렇게 하면 동일한 이미지로도 테스트용 / 운영용 환경을 분리하여 배포할 수 있습니다.
- 또한 오버라이드 파일 덕분에 하나의 YAML 기반 관리체계를 유지할 수 있습니다.

## 컨테이너 설정
- 컨테이너의 설정은 애플리케이션을 실제로 실행할 때의 물리적 구성 요소를 정의합니다.
- 네트워크(Network):
  - 서비스 간 통신 범위를 정의 (예: app-net, db-net)
  - → 같은 네트워크에 속한 컨테이너끼리만 접근 가능

- 볼륨(Volume):
  - 데이터의 지속성을 유지 (예: 로그, DB 데이터 등)

- 리소스 제한:
  - cpus, mem_limit 등을 통해 환경별 자원 사용량 제어

```yaml
services:
  web:
    image: myapp:latest
    ports:
      - "8080:80"
    networks:
      - app-net
    deploy:
      resources:
        limits:
          cpus: "0.50"
          memory: 512M
networks:
  app-net:
    driver: bridge
```

## 애플리케이션 설정
- 동일한 이미지라도, 환경 변수(environment variables)를 통해 서로 다른 동작을 하게 만들 수 있습니다.
- 보안 정보(API 키, DB 연결 문자열 등)는 secrets로 분리 관리합니다.
- .env 파일과 env_file을 함께 활용하면 CI/CD 파이프라인에서 환경별 설정을 손쉽게 주입할 수 있습니다.

```yaml
services:
  app:
    image: myapp:latest
    env_file:
      - .env
    secrets:
      - db_password
secrets:
  db_password:
    file: ./config/db_password.txt
```

### 워크플로우 정리
| 단계           | 대상       | 주요 목적          | 설정 도구                         |
| ------------ | -------- | -------------- | ----------------------------- |
| 1. 애플리케이션 조합 | 서비스 구조   | 환경별 YAML 오버라이드 | `docker-compose.yml`, `-f` 옵션 |
| 2. 컨테이너 설정   | 실행 리소스   | 네트워크/볼륨/리소스 분리 | Compose networks, volumes     |
| 3. 애플리케이션 설정 | 실행 시점 동작 | 환경 변수, 비밀값 주입  | `.env`, `env_file`, `secrets` |

## 운영 환경 적용 예시
- 개발 환경 (dev)
  - 디버깅 모드 활성화
  - SQLite / Mock API 사용
  - 로그 레벨: debug

- 운영 환경 (prod)
  - PostgreSQL / 실제 API 사용
  - 비밀키는 secrets로 관리
  - 로그 레벨: error

- 이렇게 동일한 myapp:latest 이미지를 사용하더라도,
- 환경 변수와 설정 조합에 따라 완전히 다른 동작을 수행할 수 있습니다.

## 퀴즈


## Q1. 설정 워크플로의 핵심 원칙은?
- A) 환경마다 이미지를 다르게 빌드한다.
- B) 모든 환경에서 같은 이미지를 사용하되 설정만 다르게 한다.
- C) 도커 네트워크를 공유하지 않는다.
- D) 환경 변수는 빌드 시점에만 적용된다.

<details>
<summary>정답 보기</summary>
<b>정답: B) 모든 환경에서 같은 이미지를 사용하되 설정만 다르게 한다</b>
</details>

## Q2. 컨테이너 설정 단계에서 주로 정의하는 것은?
- A) 이미지 빌드 명령
- B) CPU, 메모리, 네트워크, 볼륨 등의 리소스 설정
- C) 환경 변수와 비밀값
- D) 코드 레벨 환경 설정

<details>
<summary>정답 보기</summary>
<b>정답: B) CPU, 메모리, 네트워크, 볼륨 등의 리소스 설정</b>
</details>

## Q3. 애플리케이션 설정을 분리하는 이유는?
- A) 배포 속도를 높이기 위해
- B) 설정 변경만으로도 환경을 바꿀 수 있도록 하기 위해
- C) 이미지 용량을 줄이기 위해
- D) 컨테이너 수를 줄이기 위해

<details>
<summary>정답 보기</summary>
<b>정답: B) 설정 변경만으로도 환경을 바꿀 수 있도록 하기 위해</b>
</details>