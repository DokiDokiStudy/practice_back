---
title: "9.1 컨테이너화된 애플리케이션에서 사용되는 모니터링 기술 스택"
categoryPath:
  - "Docker"
  - "9장 컨테이너 모니터링으로 투명성 있는 애플리케이션 만들기"
  - "9.1 컨테이너화된 애플리케이션에서 사용되는 모니터링 기술 스택"
authorNick: "관리자"
createdAt: "2025-08-27"
updateMode: "upsert"
---

# 9.1 컨테이너화된 애플리케이션에서 사용되는 모니터링 기술 스택
- 프로메테우스를 사용하면 모니터링의 중요한 측면인 일관성이 확보됩니다.
- 모든 애플리케이션을 똑같은 측정값을 통해 표준적인 형태로 모니터링할 수 있습니다.
- 도커 엔진의 측정값도 같은 형식으로 추출할 수 있습니다.
- 해당 기능을 사용하려면 프로메테우스 측정 기능을 명시적으로 활성화해야 합니다.

## 모니터링의 목적과 필요성
- 장애 조기 감지, 성능 병목 파악, 용량 계획, SLA 준수 등 운영의 핵심입니다.
- 컨테이너 환경에서는 동적 인프라(컨테이너 생성/삭제/스케일링)에 대한 실시간 가시성 확보가 매우 중요합니다.

## 주요 오픈소스 모니터링 도구
- **Prometheus**: 시계열 메트릭 수집/저장/쿼리(핵심 수집 엔진)
- **Grafana**: 시각화 및 대시보드
- **cAdvisor**: 컨테이너 리소스(CPU/메모리/네트워크 등) 모니터링
- **node-exporter**: 호스트 OS 메트릭 수집
- **Alertmanager**: 알람 관리 및 통합

## 모니터링 메트릭 종류
- **컨테이너**: 상태(Up/Down), CPU/메모리/네트워크/디스크 사용량, 재시작 횟수 등
- **호스트**: 시스템 리소스(CPU, RAM, 디스크, 네트워크)
- **애플리케이션**: 응답시간, 에러율, 트랜잭션 수, 사용자 수 등
- **네트워크/스토리지**: 트래픽, IOPS, 지연시간 등


```bash
$ vi /etc/docker/daemon.json

{
	"metrics-addr" : "0.0.0.0:9323",
	"experimental" : true
}

$ sudo systemctl restart docker

http://[IP]:9323/metrics

# HELP builder_builds_failed_total Number of failed image builds
# TYPE builder_builds_failed_total counter
builder_builds_failed_total{reason="build_canceled"} 0
builder_builds_failed_total{reason="build_target_not_reachable_error"} 0
builder_builds_failed_total{reason="command_not_supported_error"} 0
builder_builds_failed_total{reason="dockerfile_empty_error"} 0
builder_builds_failed_total{reason="dockerfile_syntax_error"} 0
builder_builds_failed_total{reason="error_processing_commands_error"} 0
builder_builds_failed_total{reason="missing_onbuild_arguments_error"} 0
builder_builds_failed_total{reason="unknown_instruction_error"} 0
# HELP builder_builds_triggered_total Number of triggered image builds
# TYPE builder_builds_triggered_total counter
builder_builds_triggered_total 0
# HELP engine_daemon_container_actions_seconds The number of seconds it takes to process each container action
# TYPE engine_daemon_container_actions_seconds histogram
engine_daemon_container_actions_seconds_bucket{action="changes",le="0.005"} 1
engine_daemon_container_actions_seconds_bucket{action="changes",le="0.01"} 1
engine_daemon_container_actions_seconds_bucket{action="changes",le="0.025"} 1
engine_daemon_container_actions_seconds_bucket{action="changes",le="0.05"} 1
engine_daemon_container_actions_seconds_bucket{action="changes",le="0.1"} 1
engine_daemon_container_actions_seconds_bucket{action="changes",le="0.25"} 1
engine_daemon_container_actions_seconds_bucket{action="changes",le="0.5"} 1
engine_daemon_container_actions_seconds_bucket{action="changes",le="1"} 1
engine_daemon_container_actions_seconds_bucket{action="changes",le="2.5"} 1
engine_daemon_container_actions_seconds_bucket{action="changes",le="5"} 1
engine_daemon_container_actions_seconds_bucket{action="changes",le="10"} 1
engine_daemon_container_actions_seconds_bucket{action="changes",le="+Inf"} 1

...
```
- 측정된 각 상태정보가 Key Value 형태로 표현되는 텍스트 기반 포맷입니다.

## Prometheus Metrics 구조 이해하기
- Prometheus가 수집하는 데이터는 모두 시계열(time-series) 기반이며, 다음 3가지 구성 요소로 구성됩니다.
  - HELP <metric_name> <설명>
  - TYPE <metric_name> <타입>
  - <metric_name>{<라벨(key=value)>} <값> <타임스탬프>

| 구성 요소 | 설명 | 예시 |
|------------|------|------|
| `HELP` | 메트릭의 의미 설명 | `# HELP http_requests_total Number of HTTP requests received` |
| `TYPE` | 메트릭의 유형(`counter`, `gauge`, `histogram`, `summary`) | `# TYPE http_requests_total counter` |
| `metric_name` | 메트릭 이름 | `http_requests_total` |
| `{라벨}` | 선택적 태그(서비스, 상태 등) | `{method="GET", status="200"}` |
| `값` | 실제 측정값 | `15432` |

이처럼 Prometheus는 단순한 Key-Value 로그가 아니라 **시간이 흐르며 누적되는 시계열 데이터 구조**를 사용합니다.  
덕분에 “초당 요청 수”, “평균 응답시간”, “에러율 변화” 등을 시간 축으로 분석할 수 있습니다.


```bash
$ hostIP=$(ip addr show enp0s5 | grep -oP '(?<=inet\\s)\\d+(\\.\\d+){3}')

$ docker container run -e DOCKER_HOST=$hostIP -d -p 9090:9090 diamol/prometheus:2.13.1
```

- prometheus 는 UI 를 통해 측정값을 확인하거나 쿼리를 실행할 수 있습니다.
- 각 상태별 컨테이너 수나 실패한 헬스 체크 횟수 같은 고수준 정보부터 도커 엔진이 점유 중인 메모리 용량 같은 저수준 정보까지 얻을 수 있습니다.


## 애플리케이션의 측정값 출력하기
- 애플리케이션의 경우 메트릭 수집 엔드포인트를 통해 수집할 수 있습니다.
- 주요 언어들은 프로메테우스의 라이브러리가 제공됩니다.
- 라이브러리를 통해 수집된 정보는 런타임 수준의 측정값으로, 해당 컨테이너가 처리하는 작업과 부하의 정도의 정보가 런타임의 관점에서 표현됩니다.

```bash
$ vi docker-compose.yml

version: "3.7"

services:
  accesslog:
    image: diamol/ch09-access-log
    ports:
      - "8012:80"
    networks:
      - app-net

  iotd:
    image: diamol/ch09-image-of-the-day
    ports:
      - "8011:80"
    networks:
      - app-net

  image-gallery:
    image: diamol/ch09-image-gallery
    ports:
      - "8010:80"
    depends_on:
      - accesslog
      - iotd
    networks:
      - app-net

  prometheus:
    image: diamol/ch09-prometheus
    ports:
      - "9090:9090"
    environment:
      - DOCKER_HOST=${HOST_IP}
    networks:
      - app-net

networks:
  app-net:
    external:
      name: nat

$ docker rm -f $(docker ps -aq)

$ docker network create nat

$ docker compose -f docker-compose.yml up -d

# http://[HOST_IP]:8010/metrics

# HELP go_gc_duration_seconds A summary of the GC invocation durations.
# TYPE go_gc_duration_seconds summary
go_gc_duration_seconds{quantile="0"} 0
go_gc_duration_seconds{quantile="0.25"} 0
go_gc_duration_seconds{quantile="0.5"} 0
go_gc_duration_seconds{quantile="0.75"} 0
go_gc_duration_seconds{quantile="1"} 0
go_gc_duration_seconds_sum 0
go_gc_duration_seconds_count 0

...
```

- 이러한 런타임 상태 측정값은 도커 엔진에서 얻은 인프라스트러처 측정값과는 또 다른 수준의 정보를 제공합니다.
- 애플리케이션의 이벤트 수, 평균 응답 처리 시간, 활성 사용자 수 등의 애플리케이션 연산 정보 부터 비즈니스 정보 등을 표현할 수 있습니다.

## 퀴즈
### Q1. 컨테이너 환경에서 모니터링이 중요한 이유로 옳지 않은 것은?
- A) 장애 조기 감지
- B) 성능 병목 파악
- C) 컨테이너 자동 배포
- D) 용량 계획

<details>
<summary>정답 보기</summary>
<b>정답: C) 컨테이너 자동 배포</b><br>
자동 배포는 모니터링의 직접적 목적이 아닙니다.
</details>

### Q2. 다음 중 컨테이너/호스트/애플리케이션/네트워크 등 다양한 계층의 메트릭을 수집하는 대표적인 오픈소스 도구가 아닌 것은?
- A) Prometheus
- B) Grafana
- C) cAdvisor
- D) node-exporter

<details>
<summary>정답 보기</summary>
<b>정답: C) cAdvisor</b><br>
Grafana는 시각화 도구이며, 메트릭 수집은 하지 않습니다.
</details>

### Q3. 도커 엔진의 메트릭을 Prometheus에서 수집하려면 반드시 필요한 설정은?
- A) 도커 데몬의 metrics-addr 활성화
- B) 컨테이너에 환경변수 추가
- C) Grafana 설치
- D) Alertmanager 연동

<details>
<summary>정답 보기</summary>
<b>정답: A) 도커 데몬의 metrics-addr 활성화</b><br>
도커 엔진의 메트릭을 Prometheus에서 수집하려면 도커 데몬의 metrics-addr을 활성화해야 메트릭을 수집할 수 있습니다.
</details>
