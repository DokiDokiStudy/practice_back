---
title: '연습문제'
categoryPath:
  - 'Docker'
  - '2장 도커의 기본적인 사용법'
  - '2.6 연습문제'
authorNick: '관리자'
createdAt: '2025-08-10'
updateMode: 'upsert'
---

# 연습하기

이번 연습을 통해 컨테이너의 파일 시스템 특성과 데이터 지속성에 대해 실습해보겠습니다. 직접 해보면서 컨테이너의 임시적 특성을 이해하고, 데이터를 영구적으로 보존하는 방법을 학습합니다.

## 학습 목표
- 컨테이너의 임시적(ephemeral) 특성 이해
- 파일 시스템 격리 원리 체험  
- 데이터 지속성 문제와 해결방법 학습
- Docker의 볼륨과 바인드 마운트 개념 습득

## 교재 연습문제

앞서 실행한 웹사이트 컨테이너를 실행하고 index.html파일을 교체해 웹페이지의 내용을 수정해보세요.

힌트 
- 
- docker container명령을 사용하면 컨테이너를 대상으로 할 수 있는 일의 목록을 볼 수 있다.
- 모든 docker 명령에 --help 플래그를 추가하면 해당 명령의 도움말을 볼 수 있다.
- 도커 이미지 diamol/ch02-hello-diamol-web 안에서 웹 페이지 파일이 위치한 경로는 /usr/local/apache2/htdocs다(윈도의 경우 C:\usr\local\apache2\htdocs)

## 연습 문제 1: 컨테이너의 임시성 체험

### 단계 1: 컨테이너에서 파일 생성하기
```bash
# Ubuntu 컨테이너 실행
docker run -it --name temp-container ubuntu bash

# 컨테이너 내부에서 다음 작업 수행
echo "Hello Docker!" > /tmp/hello.txt
echo "Container ID: $(hostname)" >> /tmp/hello.txt
echo "Current time: $(date)" >> /tmp/hello.txt

# 파일 내용 확인
cat /tmp/hello.txt

# 추가로 디렉토리와 파일들 생성
mkdir /tmp/mydata
echo "Important data" > /tmp/mydata/important.txt
echo "Configuration" > /tmp/mydata/config.txt

# 생성된 파일들 확인
ls -la /tmp/
ls -la /tmp/mydata/

# 컨테이너에서 나가기
exit
```


### 단계 2: 데이터 소실 확인
```bash
# 같은 이미지로 새로운 컨테이너 실행
docker run -it ubuntu bash

# 이전에 생성한 파일이 있는지 확인
ls /tmp/
cat /tmp/hello.txt  # 파일이 없음!

# 컨테이너에서 나가기
exit
```

### 단계 3: 중지된 컨테이너에서 데이터 확인
```bash
# 이전 컨테이너 재시작
docker start temp-container
docker attach temp-container

# 데이터가 여전히 존재하는지 확인
cat /tmp/hello.txt  # 파일이 존재함!
ls /tmp/mydata/

# 컨테이너에서 나가기 (Ctrl+P, Ctrl+Q로 컨테이너를 종료하지 않고 나가기)
```

**질문**: 왜 새로운 컨테이너에서는 파일이 없었지만, 기존 컨테이너를 재시작하면 파일이 있을까요?

## 연습 문제 2: docker cp를 이용한 파일 복사

### 호스트와 컨테이너 간 파일 복사하기
```bash
# 실행 중인 컨테이너에서 파일을 호스트로 복사
docker cp temp-container:/tmp/hello.txt ./hello-from-container.txt

# 복사된 파일 확인
cat hello-from-container.txt

# 호스트에서 파일을 생성하고 컨테이너로 복사
echo "Hello from host!" > hello-from-host.txt
docker cp hello-from-host.txt temp-container:/tmp/

# 컨테이너에서 확인
docker exec temp-container cat /tmp/hello-from-host.txt
```

### 디렉토리 전체 복사하기
```bash
# 컨테이너의 디렉토리를 호스트로 복사
docker cp temp-container:/tmp/mydata ./mydata-backup

# 복사된 디렉토리 확인
ls -la mydata-backup/

# 호스트에서 디렉토리를 컨테이너로 복사
mkdir host-data
echo "Host file 1" > host-data/file1.txt
echo "Host file 2" > host-data/file2.txt
docker cp host-data temp-container:/tmp/

# 컨테이너에서 확인
docker exec temp-container ls -la /tmp/host-data/
```

## 연습 문제 3: 볼륨 마운트로 데이터 지속성 해결

### 바인드 마운트 사용하기
```bash
# 호스트 디렉토리 생성
mkdir -p ~/docker-volumes/persistent-data

# 호스트 디렉토리를 컨테이너에 마운트
docker run -it -v ~/docker-volumes/persistent-data:/data ubuntu bash

# 컨테이너 내부에서 마운트된 디렉토리에 파일 생성
echo "This data will persist!" > /data/persistent.txt
echo "Container hostname: $(hostname)" >> /data/persistent.txt
echo "Created at: $(date)" >> /data/persistent.txt

# 파일 확인
cat /data/persistent.txt
ls -la /data/

# 컨테이너 종료
exit
```

### 데이터 지속성 확인
```bash
# 호스트에서 파일이 생성되었는지 확인
ls ~/docker-volumes/persistent-data/
cat ~/docker-volumes/persistent-data/persistent.txt

# 새로운 컨테이너로 같은 볼륨 마운트
docker run -it -v ~/docker-volumes/persistent-data:/data ubuntu bash

# 이전 데이터가 여전히 존재하는지 확인
cat /data/persistent.txt  # 데이터가 보존됨!

# 추가 데이터 생성
echo "Added from second container" >> /data/persistent.txt
echo "Second container hostname: $(hostname)" >> /data/persistent.txt

# 컨테이너 종료
exit

# 호스트에서 업데이트된 내용 확인
cat ~/docker-volumes/persistent-data/persistent.txt
```

## 연습 문제 4: Docker 볼륨 사용하기

### Docker 관리 볼륨 생성
```bash
# 새로운 Docker 볼륨 생성
docker volume create my-app-data

# 볼륨 목록 확인
docker volume ls

# 볼륨 상세 정보 확인
docker inspect my-app-data
```

### Docker 볼륨 사용하기
```bash
# Docker 볼륨을 컨테이너에 마운트
docker run -it --name volume-test -v my-app-data:/app/data ubuntu bash

# 볼륨에 데이터 생성
mkdir -p /app/data
echo "App data v1.0" > /app/data/app.log
echo "User sessions" > /app/data/sessions.db
echo "Configuration" > /app/data/config.json

# 생성된 파일들 확인
ls -la /app/data/
cat /app/data/app.log

# 컨테이너 종료 및 제거
exit
docker rm volume-test
```

### 볼륨 데이터 지속성 확인
```bash
# 새로운 컨테이너에서 같은 볼륨 사용
docker run -it --name volume-test2 -v my-app-data:/app/data ubuntu bash

# 이전 데이터 확인
ls -la /app/data/
cat /app/data/app.log  # 데이터가 보존됨!

# 컨테이너 종료
exit
```

## 연습 문제 5: 실제 애플리케이션 시나리오

### 웹 서버 로그 지속성 구현
```bash
# 로그 저장용 디렉토리 생성
mkdir -p ~/docker-volumes/nginx-logs

# Nginx 컨테이너를 로그 볼륨과 함께 실행
docker run -d --name nginx-with-logs \
  -p 8080:80 \
  -v ~/docker-volumes/nginx-logs:/var/log/nginx \
  nginx

# 웹사이트에 몇 번 접속하여 로그 생성
curl http://localhost:8080
curl http://localhost:8080/nonexistent-page

# 호스트에서 로그 파일 확인
ls ~/docker-volumes/nginx-logs/
tail -f ~/docker-volumes/nginx-logs/access.log
```

### 데이터베이스 데이터 지속성
```bash
# MySQL 데이터 볼륨 생성
docker volume create mysql-data

# MySQL 컨테이너 실행 (데이터 볼륨 마운트)
docker run -d --name mysql-persistent \
  -e MYSQL_ROOT_PASSWORD=mypassword \
  -e MYSQL_DATABASE=testdb \
  -v mysql-data:/var/lib/mysql \
  -p 3306:3306 \
  mysql:8.0

# 데이터베이스에 연결하여 테스트 데이터 생성
docker exec -it mysql-persistent mysql -uroot -pmypassword testdb

# MySQL 프롬프트에서:
# CREATE TABLE users (id INT AUTO_INCREMENT PRIMARY KEY, name VARCHAR(50));
# INSERT INTO users (name) VALUES ('Alice'), ('Bob'), ('Charlie');
# SELECT * FROM users;
# EXIT;

# 컨테이너 중지 및 제거
docker stop mysql-persistent
docker rm mysql-persistent

# 새로운 컨테이너로 같은 볼륨 사용
docker run -d --name mysql-restored \
  -e MYSQL_ROOT_PASSWORD=mypassword \
  -v mysql-data:/var/lib/mysql \
  -p 3306:3306 \
  mysql:8.0

# 데이터가 보존되었는지 확인
# docker exec -it mysql-restored mysql -uroot -pmypassword testdb
# SELECT * FROM users;  -- 이전 데이터가 그대로 있음
```

## 연습 문제 6: 읽기 전용 마운트

### 설정 파일을 읽기 전용으로 마운트
```bash
# 설정 파일 생성
mkdir -p ~/docker-volumes/config
echo "server_name=production" > ~/docker-volumes/config/app.conf
echo "debug=false" > ~/docker-volumes/config/app.conf
echo "log_level=info" >> ~/docker-volumes/config/app.conf

# 읽기 전용으로 마운트
docker run -it -v ~/docker-volumes/config:/etc/config:ro ubuntu bash

# 설정 파일 읽기 (가능)
cat /etc/config/app.conf

# 설정 파일 수정 시도 (실패해야 함)
echo "hacked=true" >> /etc/config/app.conf  # Read-only 오류 발생

# 컨테이너 종료
exit
```

## 문제 해결 및 디버깅

### 볼륨 관련 문제 진단
```bash
# 모든 볼륨 목록 확인
docker volume ls

# 사용되지 않는 볼륨 찾기
docker volume ls -f dangling=true

# 볼륨 상세 정보 확인
docker inspect <volume-name>

# 컨테이너의 마운트 정보 확인
docker inspect <container-name> | grep -A 20 '"Mounts"'
```

### 일반적인 문제들과 해결방법

#### 권한 문제
```bash
# 볼륨 디렉토리의 권한 확인
ls -la ~/docker-volumes/

# 권한 문제 해결
sudo chown -R $(id -u):$(id -g) ~/docker-volumes/
```

#### 볼륨 정리
```bash
# 사용되지 않는 볼륨 제거
docker volume prune

# 특정 볼륨 제거
docker volume rm <volume-name>
```

## 정리 및 핵심 개념

### 이번 연습에서 학습한 내용:

1. **컨테이너의 임시성**: 컨테이너가 제거되면 내부 데이터도 함께 사라짐
2. **데이터 지속성 방법**:
   - `docker cp`: 일회성 파일 복사
   - **바인드 마운트**: 호스트 디렉토리를 컨테이너에 연결
   - **Docker 볼륨**: Docker가 관리하는 지속적 저장소
3. **볼륨의 장점**: 호스트 시스템과 독립적, Docker가 관리, 성능 최적화
4. **읽기 전용 마운트**: 설정 파일 등을 안전하게 공유

### 실무 적용 포인트:

**로그 파일**: 항상 볼륨으로 분리하여 지속성 보장  
**데이터베이스**: 데이터 손실 방지를 위해 반드시 볼륨 사용  
**설정 파일**: 읽기 전용 마운트로 보안 강화  
**개발 환경**: 바인드 마운트로 실시간 코드 반영  

### 다음 단계 예고:
다음 3장에서는 직접 Docker 이미지를 만들어보면서, 애플리케이션을 컨테이너화하는 방법을 배워보겠습니다! 🚀


<!-- diamol/ch02-hello-diamol-web의 index.html 파일 교체
index.html의 위치는 /usr/local/apache2/htdocs

1. 우선 컨테이너를 실행한다.
docker container run -d -p 8088:80 diamol/ch02-hello-diamol-web
34f5ab981f14dd8730bc72853b9cd1e2bdaeeff4a625217e0671ec8ce971e670

2. 사이트 접속후 확인

2. 실행중인 컨테이너의 디렉토리 조회
docker exec -it 34 sh
/usr/local/apache2 # cd htdocs
/usr/local/apache2/htdocs # ls

3. index.html 수정한 파일을 컨테이너에 복사
docker cp index.html 34:/usr/local/apache2/htdocs
Successfully copied 2.05kB to 17:/usr/local/apache2/htdocs

4. localhost:8088에 접속하여 확인

힘들었던점 : 
처음에 exec명령어로 cd를 이용해서 디렉토리를 찾아가려했지만 
exec명령어는 실행후 세션이 종료되기에 cd를 통해서 디렉토리를 찾아가더라도 바로 세션이 종료되면서 원래 경로로 돌아가는 문제가 있었고
docker exec -it 34 sh를 통해서 세션에 접속한채로 명령어를 사용 -->