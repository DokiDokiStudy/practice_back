---
title: '나만의 도커 레지스트리 운영하기'
authorNick: '관리자'
createdAt: '2025-08-27'
updateMode: 'upsert'
---

# 5.3 나만의 도커 레지스트리 운영하기

회사나 팀 내부에서 사용할 **전용 레지스트리**를 직접 운영할 수 있습니다.  
로컬 네트워크에 전용 레지스트리가 있으면 다음과 같은 장점을 누릴 수 있습니다.

✅ **인터넷 회선 사용량 감소** - 외부 다운로드 최소화  
✅ **전송 시간 절약** - 로컬 네트워크는 훨씬 빠름  
✅ **안정성 향상** - 공개 레지스트리 장애 시 신속한 전환

도커 코어 레지스트리 서버는 GitHub의 `docker/distribution` 저장소에서 개발되며,  
도커 허브와 동일한 **레이어 캐시 시스템**을 사용합니다.

> 다만, 도커 허브와 달리 **웹 기반 UI는 제공하지 않습니다.**

<br/>

## 🚀 실습: 로컬 레지스트리 구축하기

### Step 1: 레지스트리 컨테이너 실행

```bash
docker container run -d -p 5000:5000 --restart always diamol/registry
```

**실행 결과:**

```
Unable to find image 'diamol/registry:latest' locally
latest: Pulling from diamol/registry
6a2aeb3b52c0: Download complete
3fec9ac2e0fe: Download complete
31603596830f: Download complete
792f5419a843: Download complete
b72408f4bc4f: Download complete
aea0fab1b866: Download complete
Digest: sha256:49c5a928c870d496013d98d4357c93f35b1896a0385ef275664bc43e69b14950
Status: Downloaded newer image for diamol/registry:latest
a35bca09b29c7e26d4a80d7ad26f17072b100c04ca3cc77a809f9ddd8d03ba72
```

<br/>
<details>
<summary><strong>👆 --restart always 옵션</strong></summary>

레지스트리는 항상 실행 중이어야 하는 서비스입니다.

- 시스템 재부팅 시 자동으로 레지스트리 시작
- 컨테이너 오류로 종료되어도 자동 재시작
- 안정적인 서비스 운영 가능

```bash
# restart 정책 옵션들
--restart no          # 재시작 안 함 (기본값)
--restart on-failure  # 오류로 종료된 경우만 재시작
--restart always      # 항상 재시작
--restart unless-stopped  # 수동 종료 전까지 재시작
```

</details>
<br/>

<br/>

### Step 2: 도메인 네임 추가하기

`localhost:5000`만으로는 **로컬 컴퓨터에서만 접근 가능**합니다.  
도메인 네임을 추가하면 네트워크상의 다른 컴퓨터에서도 사용할 수 있습니다.

**Windows (PowerShell - 관리자 권한):**

```powershell
Add-Content -Value "127.0.0.1 registry.local" -Path /windows/system32/drivers/etc/hosts
```

**Mac / Linux:**

```bash
echo $'\n127.0.0.1 registry.local' | sudo tee -a /etc/hosts
```

**도메인 네임 확인:**

```bash
ping registry.local
```

**실행 결과:**

```
PING registry.local (127.0.0.1): 56 data bytes
64 bytes from 127.0.0.1: icmp_seq=0 ttl=64 time=0.074 ms
64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.128 ms
64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.183 ms
64 bytes from 127.0.0.1: icmp_seq=3 ttl=64 time=0.244 ms
64 bytes from 127.0.0.1: icmp_seq=4 ttl=64 time=0.085 ms
64 bytes from 127.0.0.1: icmp_seq=5 ttl=64 time=0.202 ms
```

<br/>

### Step 3: 비보안 레지스트리 설정

로컬 레지스트리는 **HTTP(비보안 프로토콜)** 를 사용합니다.  
도커는 기본적으로 **HTTPS만 허용**하기 때문에 추가 설정이 필요합니다.

<details>
<summary><strong>👆 왜 비보안 레지스트리 설정이 필요한가?</strong></summary>

도커는 보안을 위해 <strong>기본적으로 HTTPS 레지스트리만 허용</strong>합니다.

**문제:**

- 로컬 개발 환경에서 SSL 인증서 설정은 번거로움
- 테스트용 레지스트리에 HTTPS 설정은 과도함

**해결:**

- 특정 레지스트리를 "비보안 허용 목록"에 추가
- **주의:** 프로덕션 환경에서는 반드시 HTTPS 사용!

</details>

#### 도커 데스크탑 UI로 설정하기

1. 태스크 바에서 **도커 고래 아이콘** 우클릭
2. **Settings** (Mac: **Preferences**) 클릭
3. **Docker Engine** 탭 선택
4. JSON 설정에 다음 내용 추가:

```json
{
  "insecure-registries": ["registry.local:5000"]
}
```

5. **Apply & Restart** 클릭하여 도커 엔진 재시작

#### 설정 확인

```bash
docker info
```

**출력 결과에서 확인:**

```
...
Insecure Registries:
  registry.local:5000
  127.0.0.0/8
...
```

<br/>

### Step 4: 이미지 태그 및 푸시

이제 로컬 레지스트리를 사용할 준비가 끝났습니다!

**이미지에 로컬 레지스트리 참조 부여:**

```bash
docker image tag image-gallery registry.local:5000/gallery/ui:v1
```

**로컬 레지스트리에 푸시:**

```bash
docker image push registry.local:5000/gallery/ui:v1
```

<br/>

### Step 5: 프로젝트 단위로 관리하기

로컬 레지스트리에서는 **경로 구조**를 활용해 이미지를 체계적으로 관리할 수 있습니다.

```bash
# gallery 프로젝트의 여러 애플리케이션
registry.local:5000/gallery/ui:v1
registry.local:5000/gallery/api:v1
registry.local:5000/gallery/logs:v1
```

**장점:**

- 프로젝트별로 이미지 그룹화
- 체계적인 버전 관리
- 팀 간 이미지 공유 용이

<br/>

## ⚠️ 보안 주의사항

### 비보안 레지스트리의 위험성

**HTTP를 사용하면:**

- 🚨 도커 엔진과 레지스트리 간 통신 내용을 **제3자가 엿볼 수 있음**
- 🚨 이미지 푸시 과정에서 **레이어가 노출될 수 있음**
- 🚨 민감한 정보(API 키, 비밀번호 등)가 포함된 이미지는 **절대 사용 금지**

### 권장 사항

**개발/테스트 환경:**

```bash
# ✅ 로컬 네트워크에서만 사용
registry.local:5000
```

**프로덕션 환경:**

```bash
# ✅ HTTPS 필수
https://registry.company.com

# SSL 인증서 설정
# 비보안 레지스트리 목록에서 제거
```

<br/>

## 🏷️ 주요 명령어 정리

| 명령어                        | 설명                               | 예시                                        |
| ----------------------------- | ---------------------------------- | ------------------------------------------- |
| `docker run --restart always` | 항상 재시작 설정으로 컨테이너 실행 | `docker run -d --restart always registry:2` |
| `docker info`                 | 도커 엔진 정보 확인                | `docker info`                               |

<br/>

## 🎮 연습 문제

**문제 1:** 로컬 레지스트리를 사용하려면 도커 엔진 설정에 `insecure-registries`를 추가해야 하는 이유는?

A. 레지스트리 성능을 높이기 위해  
B. 로컬 레지스트리는 HTTP를 사용하는데 도커는 기본적으로 HTTPS만 허용하기 때문에  
C. 도커 허브와 충돌을 방지하기 위해  
D. 이미지 다운로드 속도를 높이기 위해

<details>
<summary><strong>정답 보기</strong></summary>

**정답: B**

로컬 레지스트리는 HTTP(비보안 프로토콜)를 사용하지만, 도커는 보안을 위해 기본적으로 HTTPS만 허용합니다. 따라서 HTTP를 사용하는 레지스트리를 허용 목록에 추가해야 합니다.

**주의:** 프로덕션 환경에서는 반드시 HTTPS 사용!

</details>
<br/>

**문제 2:** hosts 파일에 `127.0.0.1 registry.local`을 추가하는 목적은?

A. 레지스트리 보안을 강화하기 위해  
B. `registry.local` 도메인 이름을 localhost IP로 연결하기 위해  
C. 도커 허브 대신 로컬 레지스트리를 기본으로 설정하기 위해  
D. 이미지 푸시 속도를 높이기 위해

<details>
<summary><strong>정답 보기</strong></summary>

**정답: B**

hosts 파일은 도메인 이름과 IP 주소를 매핑하는 파일입니다. `registry.local`이라는 도메인 이름을 `127.0.0.1`(localhost)로 연결하여, `registry.local:5000`으로 로컬 레지스트리에 접근할 수 있게 합니다.

</details>
