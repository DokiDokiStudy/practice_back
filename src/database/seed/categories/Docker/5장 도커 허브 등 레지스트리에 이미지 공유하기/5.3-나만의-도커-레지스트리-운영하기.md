---
title: '나만의 도커 레지스트리 운영하기'
categoryPath:
  - 'Docker'
  - '5장 나만의 도커 레지스트리 운영하기'
  - '5.3 컨테이너가 IT 세상을 점령한 이유'
authorNick: '관리자'
createdAt: '2025-08-27'
updateMode: 'upsert'
---

# 나만의 도커 레지스트리 운영하기

## 🖥️ 로컬 레지스트리

로컬 네트워크에 전용 레지스트리가 있으면 다음과 같은 장점을 누릴 수 있습니다.
1. 인터넷 회신 사용량 감소
2. 전송 시간 절약
3. 공개 레지스트리가 사용불가할 때에 신속하게 전환 가능

도커 코어 레지스트리 서버는 깃허브 저장소 docker/distribution에서 개발이 진행되는데, <br>
도커 허브와 동일한 레이어 캐시 시스템을 통해서 이미지를 내려받고 푸쉬합니다.

> 다만, 도커 허브와는 다르게 웹 기반의 UI는 없습니다.

### 🚀 이미지로 도커 레지스트리 실행

우선 ``diamol``에서 예시로 제공해주는 이미지로 실습을 진행해보겠습니다.

```
# --restart를 이용하여 도커 재시작시 자동으로 컨테이너 재시작
docker container run -d -p 5000:5000 --restart always diamol/registry

# 이미지 다운 및 컨테이너 실행
Unable to find image 'diamol/registry:latest' locally
latest: Pulling from diamol/registry
6a2aeb3b52c0: Download complete
3fec9ac2e0fe: Download complete
31603596830f: Download complete
792f5419a843: Download complete
b72408f4bc4f: Download complete 
aea0fab1b866: Download complete
Digest: sha256:49c5a928c870d496013d98d4357c93f35b1896a0385ef275664bc43e69b14950
Status: Downloaded newer image for diamol/registry:latest
a35bca09b29c7e26d4a80d7ad26f17072b100c04ca3cc77a809f9ddd8d03ba72
```

위의 명령어를 통해서 컨테이너를 실행하면 전용 레지스트리가 생깁니다. <br>
이 레지스트리 서버의 포트는 5000으로 ``localhost:5000``을 사용하여 <br>
이미지에 태그를 부여하면 새로운 레지스트리에 이미지를 푸쉬할 수 있습니다.

### 👨🏻‍💻 도메인 네임 추가

이전에 사용한 레지스트리는 로컬 컴퓨터에서만 접근가능하기 때문에 활용도가 높지는 않습니다. <br>
이때 아래의 운영체제별 명령어를 통해 로컬 컴퓨터에 도메인 네임을 추가하여 활용도를 높일 수 있습니다. 

```
# 윈도 환경
Add-Content -Value "127.0.0.1 registry.local" -Path /windows/system32/drivers/etc/hosts

# 리눅스, MacOs 환경
echo $'\n127.0.0.1 registry.local' | sudo tee -a /etc/hosts

# 추가된 도메인 네임 호출
ping registry.local

# 성공적으로 호출
Ping registry.local [127.0.0.1] 32바이트 데이터 사용:
127.0.0.1의 응답: 바이트=32 시간<1ms TTL=128
127.0.0.1의 응답: 바이트=32 시간<1ms TTL=128
127.0.0.1의 응답: 바이트=32 시간<1ms TTL=128
127.0.0.1의 응답: 바이트=32 시간<1ms TTL=128

127.0.0.1에 대한 Ping 통계:
    패킷: 보냄 = 4, 받음 = 4, 손실 = 0 (0% 손실),
왕복 시간(밀리초):
    최소 = 0ms, 최대 = 0ms, 평균 = 0ms
```

> ``Ping registry.local [127.0.0.1]``
>  - registry.local - 위에서 추가했던 도메인 네임으로 ping을 보내는 명령어
>  - 127.0.0.1 - 자기 자신의 ip주소

### 📡 로컬 도메인 네임으로 이미지 참조하기

추가된 도메인 네임을 이미지앞에 사용하여 이미지 참조를 새롭게 부여할 수 있습니다.

> docker image tag ${image명} registry.local:5000/{image명}

또한 레지스트리 안에 여러개의 애플리케이션을 프로젝트 단위로 묶어서 관리할 수도 있습니다.

```
# registry.local:5000의 gallery안에 여러가지 애플리케이션을 넣을 수 있다.
registry.local:5000/gallery/ui:v1
registry.local:5000/gallery/api:v1
registry.local:5000/gallery/logs:v1
...
```

### ⬆️ 로컬 레지스트리에 이미지 푸쉬

로컬 컴퓨터의 레지스트리에 이미지를 푸쉬하려면 비보안 프로토콜인 HTTP을 사용하는데, <br>
도커의 기본설정으로는 비보안 프로토콜 사용이 불가능하기에 추가 설정이 필요합니다.

> 도커 엔진의 모든 설정은 ``daemon.json`` 파일 안에 저장되어 있습니다. <br>
> 윈도우의 경우에는 ``C:\Program Data\docker\config`` <br>
> 리눅스에서는 ``/etc/docker``에 저장되어 있습니다.

``daemon.json`` 파일을 직접 편집해도 무관하지만 여기서는 도커 데스크탑의 UI를 통해서 편집해보겠습니다.
- 태스크 바에 도커 고래 아이콘을 우클릭한뒤 컨텍스트 메뉴에서 setting(Macos: Preference) 클릭
- Daemon 탭에서 비보안 레지스틜 목록에 registry.local:5000 추가
- 도커 엔진 재시작 후 daemon.json파일을 열어 목록을 추가

```
{
  "insecure-registries": ["registry.local:5000"]
}
```

명령어로 이미지를 푸쉬합니다.
이후 *docker info*를 통해서 허용목록에 포함여부를 확인한 후에 

```
docker image push registry.local:5000/gallery/ui:v1
```

위의 과정을 거치면 로컬 네트워크상의 컴퓨터들끼리 이미지를 공유할 수 있게 됩니다.

---

### ⚠️ 주의 

비보안 레지스트리는 편리하면서도 보안상의 주의가 필요합니다. <br> 
도커 엔진과 레지스트리의 통신 내용을 제3자가 엿볼 수 있으며, 이미지 푸쉬 과정에서 <br>
레이어가 노출될 수도 있습니다.

---

## 🎮 연습 문제

**문제 1:** 로컬 네트워크에 전용 도커 레지스트리를 운영할 때 얻을 수 있는 **세 가지 장점**을 적어보세요.

<details>
<summary><strong>정답 보기</strong></summary>

💡 정답: 
- 인터넷 회선 사용량 감소  
- 전송 시간 절약  
- 공개 레지스트리(도커 허브)가 불가할 때 신속한 전환 가능  

> **설명:** 내부 네트워크에서 이미지 전송이 가능하므로 배포 속도와 안정성이 향상됩니다.
</details>
<br/>

**문제 2:** `diamol/registry` 이미지를 이용해 로컬 레지스트리를 실행하는 명령어를 작성해보세요. (도커 재시작 시 자동 재실행되도록 설정 추가)

<details>
<summary><strong>정답 보기</strong></summary>
💡 정답:

```bash
docker container run -d -p 5000:5000 --restart always diamol/registry
```
</details>
<br/>

**문제 3:** 추가된 도메인이 올바르게 설정되었는지 확인하기 위해 사용하는 명령어는 무엇인가요?


<details>
<summary><strong>정답 보기</strong></summary>
💡 정답:

```bash
ping registry.local
```
</details>
<br/>

**문제 4:** 기존 이미지에 로컬 레지스트리 주소를 붙여 새로운 태그를 부여하는 명령어를 작성해보세요.


<details>
<summary><strong>정답 보기</strong></summary>
💡 정답:

```bash
docker image tag {이미지명} registry.local:5000/{이미지명}
```
</details>
<br/>

**문제 5:** 로컬 레지스트리에 이미지를 푸쉬하려면 도커의 기본 설정 중 어떤 파일을 수정해야 하나요?


<details>
<summary><strong>정답 보기</strong></summary>

💡 정답: ``daemon.json``

</details>
<br/>