---
title: "11.2 도커를 이용한 빌드 인프라스트럭처 구축하기"
categoryPath:
  - "Docker"
  - "11장 도커와 도커 컴포즈를 이용한 애플리케이션 빌드 및 테스트"
  - "11.2 도커를 이용한 빌드 인프라스트럭처 구축하기"
authorNick: "관리자"
createdAt: "2025-08-27"
updateMode: "upsert"
---

# 11.2 도커를 이용한 빌드 인프라스트럭처 구축하기

## 개요

외부 매니지드 서비스가 무료로 제공되지만, 직접 빌드 인프라를 구축하는 것은 다음과 같은 이점이 있다:

- 보안 강화 및 데이터 통제
- 네트워크 속도 최적화
- 외부 서비스 장애 시 비상 대책
- 소스코드와 이미지의 내부 관리

## 필수 컴포넌트 구성

### 1. 기본 구성요소

| 컴포넌트 | 역할 | 오픈소스 도구 |
|---------|------|--------------|
| 형상관리 | 소스코드 관리 | Gogs |
| 이미지 저장소 | 컨테이너 이미지 배포 | Docker Registry |
| CI 서버 | 자동화 빌드/테스트 | Jenkins |

### 2. 환경 설정

**리눅스/맥 환경:**
```bash
# 컨테이너 실행
docker compose -f docker-compose.yml -f docker-compose-linux.yml up -d

# 레지스트리 도메인 설정
echo $'\n127.0.0.1 registry.local' | sudo tee -a /etc/hosts
```

**윈도우 환경:**
```powershell
# 컨테이너 실행
docker compose -f docker-compose.yml -f docker-compose-windows.yml up -d

# 레지스트리 도메인 설정
Add-Content -Value "127.0.0.1 registry.local" -Path /windows/system32/drivers/etc/hosts
```

## 컴포넌트별 설정 방법

### 1. Docker Registry

- 별도 설정 없이 즉시 사용 가능
- 이미지 태그에 `registry.local:<포트>` 형식으로 도메인 지정

### 2. Jenkins

#### 특징
- 플러그인 기반 기능 확장
- 도커 이미지로 패키징 가능
- 스크립트를 통한 자동화 지원

#### 설정 단계
1. `http://localhost:<Jenkins포트>` 접속
2. 기본 계정으로 로그인
3. 필요한 플러그인 설치
4. CI 파이프라인 구성

### 3. Gogs (Git 서버)

#### 초기 설정
1. `http://localhost:<Gogs포트>` 접속
2. "Install Gogs" 클릭
3. 관리자 계정 생성
4. 저장소 생성: `http://localhost:<Gogs포트>/repo/create`

#### Git 저장소 연결
```bash
# 원격 저장소 추가
git remote add local http://localhost:<Gogs포트>/diamol/diamol.git

# 코드 푸시
git push local
```

## 도커 기반 CI 파이프라인 구성

### 1. Jenkins와 도커 연동

```yaml
# docker-compose.yml
services:
  jenkins:
    image: diamol/jenkins
    ports:
      - "8080:8080"
    networks:
      - infrastructure

# Linux 환경 설정
# docker-compose-linux.yml
jenkins:
  volumes:
    - type: bind
      source: /var/run/docker.sock
      target: /var/run/docker.sock

# Windows 환경 설정
# docker-compose-windows.yml
jenkins:
  volumes:
    - type: npipe
      source: \\.\pipe\docker_engine
      target: \\.\pipe\docker_engine
```

### 2. CI 파이프라인 동작 방식

1. Git 서버 코드 변경 감지 (1분 주기)
2. 변경 감지시 자동 빌드 실행
3. 수동 실행 옵션 ("Build Now")
4. 빌드 결과 및 단계별 상태 확인

### 3. 보안 고려사항

- 컨테이너의 도커 엔진 접근 제어 필요
- 호스트 시스템 접근 권한 제한
- 네트워크 격리 설정

## 결론

도커를 이용한 빌드 인프라 구축은 완전한 통제권과 유연성을 제공한다. 하지만 적절한 관리와 보안 설정이 필수적이며, 조직의 요구사항과 리소스를 고려하여 자체 구축 여부를 결정해야 한다.