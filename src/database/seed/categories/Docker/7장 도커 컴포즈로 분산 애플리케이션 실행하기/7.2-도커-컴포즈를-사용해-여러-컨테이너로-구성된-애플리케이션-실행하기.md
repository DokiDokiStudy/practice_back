---
title: "7.2 도커 컴포즈를 사용해 여러 컨테이너로 구성된 애플리케이션 실행하기"
categoryPath:
  - "Docker"
  - "7장 도커 컴포즈로 분산 애플리케이션 실행하기"
  - "7.2 도커 컴포즈를 사용해 여러 컨테이너로 구성된 애플리케이션 실행하기"
authorNick: "관리자"
createdAt: "2025-08-27"
updateMode: "upsert"
---

# 7.2 도커 컴포즈를 사용해 여러 컨테이너로 구성된 애플리케이션 실행하기

## 개요

도커 컴포즈를 사용하면 여러 컨테이너로 구성된 애플리케이션을 단일 명령으로 실행하고 관리할 수 있다. 이 장에서는 실제 예시를 통해 도커 컴포즈의 다양한 기능과 사용법을 살펴본다.

## 상세 내용

### 다중 컨테이너 애플리케이션 정의하기

아래는 여러 개의 컨테이너로 구성된 이미지 갤러리를 기술한 컴포즈 파일의 예시다:

```yaml
accesslog:
  image: diamol/ch04-access-log

iotd:
  image: diamol/ch04-image-of-the-day
  ports:
    - "80"

image-gallery:
  image: diamol/ch04-image-gallery
  ports:
    - "8010:80"
  depends_on:
    - accesslog
    - iotd
```

이 컴포즈 파일은 세 개의 서비스로 구성된다:

1. **accesslog 서비스**: 
   - 단순히 이미지 이름만 명시되어 있다
   - 공개 포트나 추가 설정이 없다

2. **iotd 서비스**: 
   - REST API 역할을 하는 서비스
   - 컨테이너의 80번 포트를 호스트의 임의의 포트로 공개한다
   - 호스트 포트가 명시되지 않아 도커가 자동으로 선택한다

3. **image-gallery 서비스**:
   - 웹 프론트엔드 역할을 하는 서비스
   - 컨테이너의 80번 포트를 호스트의 8010번 포트로 공개한다
   - `depends_on` 필드를 통해 accesslog와 iotd 서비스에 의존성이 있음을 명시한다
   - 도커 컴포즈는 의존성에 따라 먼저 accesslog와 iotd를 실행한 후 image-gallery를 실행한다

### 분리 모드(Detached Mode)로 애플리케이션 실행하기

분리 모드는 컨테이너를 백그라운드에서 실행하는 방식이다. 터미널 창을 계속 열어둘 필요 없이 컨테이너를 실행할 수 있다.

```bash
docker compose up --detach
```

실행 결과:
```
Creating image-of-the-day_accesslog_1    ... done
Creating image-of-the-day_iotd_1         ... done
Creating image-of-the-day_image-gallery_1 ... done
```

분리 모드로 실행하면:
- 컨테이너가 백그라운드에서 실행된다
- 터미널에 컨테이너 로그가 출력되지 않는다
- 터미널을 닫아도 애플리케이션이 계속 실행된다

### 서비스 스케일 아웃하기

스케일 아웃은 동일한 서비스의 인스턴스를 여러 개 실행하여 부하를 분산하는 기술이다. 도커 컴포즈는 간단한 명령으로 서비스를 스케일 아웃할 수 있다.

```bash
docker compose up -d --scale iotd=3
```

이 명령은:
- iotd 서비스를 3개의 컨테이너로 확장한다
- 웹 컨테이너(image-gallery)가 API에 요청할 때, 도커가 3개의 iotd 컨테이너에 요청을 고르게 분배한다
- 내부적으로 DNS 라운드 로빈 방식으로 부하를 분산한다

각 컨테이너의 로그를 확인하려면:
```bash
docker compose logs --tail=1 iotd
```

### 애플리케이션 관리 명령어

도커 컴포즈는 애플리케이션 전체 수명 주기를 관리하는 다양한 명령어를 제공한다:

| 명령어 | 설명 |
|--------|------|
| `docker compose stop` | 모든 컨테이너를 중지한다 (컨테이너 자체는 삭제되지 않음) |
| `docker compose start` | 중지된 컨테이너를 다시 시작한다 (새 컨테이너를 생성하지 않음) |
| `docker compose down` | 애플리케이션을 완전히 제거한다 (컨테이너, 네트워크, 볼륨 모두 삭제) |
| `docker compose up -d` | 애플리케이션을 시작한다 (이미 실행 중인 경우 재시작하지 않음) |

### 주의사항

1. **스케일 정보 보존**: `docker compose up -d` 명령은 이전에 `--scale` 옵션으로 설정한 스케일 아웃 정보를 보존하지 않는다. 만약 이전에 `--scale iotd=3`으로 실행했더라도, 단순히 `up -d`를 실행하면 서비스가 기본값인 1개의 컨테이너로 다운스케일된다.

2. **클라이언트 측 도구**: 도커 컴포즈는 YAML 파일에 정의된 애플리케이션 정의에 의존하는 클라이언트 측 도구다. 도커 엔진 자체는 어떤 컨테이너가 어떤 애플리케이션에 속하는지 알지 못한다.
