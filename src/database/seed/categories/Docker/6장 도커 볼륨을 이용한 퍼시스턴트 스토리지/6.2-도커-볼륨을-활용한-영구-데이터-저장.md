---
title: '6.2 도커 볼륨을 활용한 영구 데이터 저장'
authorNick: '관리자'
createdAt: '2025-10-15'
updateMode: 'upsert'
---

# 도커 볼륨을 활용한 영구 데이터 저장

## 볼륨이란?

도커 볼륨은 도커에서 스토리지를 다루는 단위로 **컨테이너를 위한 USB 메모리**라고 생각하면 이해하기 쉽다. 볼륨은 컨테이너와 독립적으로 존재하며, 별도의 생애주기를 갖지만, 컨테이너에 연결할 수 있다. 

즉 애플리케이션을 업데이트하더라도 볼륨에 연결하면 **볼륨 안의 데이터는 그대로 유지**할 수 있는 것이다.

### 볼륨의 핵심 특징

- **독립적 생애주기**: 컨테이너가 삭제되어도 볼륨은 유지
- **재사용 가능**: 여러 컨테이너에서 동일한 볼륨 사용 가능
- **도커 관리**: 도커가 직접 관리하여 안전하고 효율적
- **플랫폼 독립적**: 윈도우, 리눅스, macOS에서 동일하게 작동

---

## 볼륨 사용 방법

### Dockerfile에서 볼륨 정의

```dockerfile
# Dockerfile 일부

# 볼륨 생성후 컨테이너에 연결
VOLUME /data
COPY --from=builder /out/ .
```

### 볼륨 확인 및 관리

연결된 볼륨은 **docker volume ls** 명령어로 확인해볼 수 있다.

```bash
# 모든 볼륨 조회
docker volume ls

# 볼륨 상세 정보 확인
docker volume inspect <볼륨명>

# 사용하지 않는 볼륨 정리
docker volume prune
```

### 컨테이너 실행과 볼륨 연결

기본적으로 도커 이미지에서 볼륨을 정의하면 컨테이너를 생성할 때마다 새로운 볼륨을 만들지만 공유하게 할 수도 있다.

```bash
# 볼륨 생성 (자동으로 새 볼륨 생성)
docker container run --name todo2 -d diamol/ch06-todo-list

# MacOS 환경에서 볼륨 내용 확인
docker container exec todo2 ls /data

# 윈도 환경에서 볼륨 내용 확인
docker container exec todo2 cmd /C "dir C:\data"

# todo1의 볼륨을 공유하여 새 컨테이너 실행
docker container run -d --name t3 --volumes-from todo1 diamol/ch06-todo-list
```

### 명시적 볼륨 생성 및 연결

```bash
# 명시적으로 볼륨 생성
docker volume create my-app-data

# 생성한 볼륨을 컨테이너에 연결
docker container run -d \
  --name my-app \
  --volume my-app-data:/app/data \
  my-image:latest

# 또는 짧은 형식으로
docker container run -d \
  --name my-app \
  -v my-app-data:/app/data \
  my-image:latest
```

---

## VOLUME과 --volume의 차이점

### Dockerfile의 VOLUME 인스트럭션

```dockerfile
VOLUME ["/data"]
```

**특징:**
- 빌드된 이미지 올릴 때 볼륨 지정을 안 하면 **매번 새로운 볼륨을 생성**
- 이 볼륨은 **무작위 식별자**를 가지기에 볼륨을 재사용하려면 해당 무작위 식별자를 기억해야 한다
- 이미지 레벨에서 볼륨 필요성을 명시

### --volume 플래그 (런타임 옵션)

```bash
docker run --volume my-data:/app/data my-image
```

**특징:**
- 이미지에 볼륨이 지정 여부와 상관없이 **지정된 볼륨을 컨테이너에 마운트**
- 이미지에 볼륨이 정의되어 있어도 무시되기에 **새로운 볼륨이 생성되지 않음**
- 런타임에서 완전한 볼륨 제어 가능

### 권장사항

```bash
# ❌ 권장하지 않음 - 무작위 볼륨 생성
docker run my-image-with-volume

# ✅ 권장 - 명시적 볼륨 관리
docker run --volume my-named-volume:/data my-image
```

컨테이너 간 볼륨 공유는 **업데이트 간 상태를 보존하기 위한 용도**로 사용하는 게 좋으며, 이미지에서 정의하는 것보다는 **명시적으로 관리하는 편이 낫다**.

---

## 볼륨 사용 시나리오

### 1. 데이터베이스 데이터 보존

```bash
# PostgreSQL 컨테이너에 볼륨 연결
docker run -d \
  --name postgres-db \
  -e POSTGRES_PASSWORD=mypassword \
  -v postgres-data:/var/lib/postgresql/data \
  postgres:13
```

### 2. 로그 파일 수집

```bash
# 애플리케이션 로그를 볼륨에 저장
docker run -d \
  --name web-app \
  -v app-logs:/var/log/app \
  my-web-app:latest
```

### 3. 설정 파일 공유

```bash
# 설정 파일을 여러 컨테이너에서 공유
docker run -d \
  --name config-container \
  -v shared-config:/etc/config \
  config-image:latest

docker run -d \
  --name app1 \
  -v shared-config:/app/config:ro \
  app-image:latest

docker run -d \
  --name app2 \
  -v shared-config:/app/config:ro \
  app-image:latest
```

---

## 볼륨 관리 베스트 프랙티스

### 1. 명확한 볼륨 네이밍
```bash
# ✅ 좋은 예 - 목적이 명확한 이름
docker volume create mysql-data
docker volume create nginx-logs
docker volume create shared-uploads

# ❌ 나쁜 예 - 의미 없는 이름
docker volume create vol1
docker volume create data
```

### 2. 볼륨 백업 및 복원
```bash
# 볼륨 백업
docker run --rm -v my-data:/data -v $(pwd):/backup alpine \
  tar czf /backup/data-backup.tar.gz -C /data .

# 볼륨 복원
docker run --rm -v my-data:/data -v $(pwd):/backup alpine \
  tar xzf /backup/data-backup.tar.gz -C /data
```

### 3. 읽기 전용 마운트
```bash
# 설정 파일은 읽기 전용으로 마운트
docker run -d \
  --name my-app \
  -v config-data:/app/config:ro \
  my-image:latest
```

---

## 실습: 도커 볼륨 활용하기

### 실습 6-3: 볼륨으로 데이터 영속성 확보하기

```bash
# 1. 명시적으로 볼륨 생성
docker volume create todo-data
docker volume ls  # todo-data 확인

# 2. 볼륨을 사용하는 컨테이너 실행
docker run -d \
  --name todo-v1 \
  -v todo-data:/data \
  -p 8080:80 \
  diamol/ch06-todo-list

# 3. 웹 브라우저에서 http://localhost:8080 접속하여 할일 추가

# 4. 컨테이너 삭제 후 새 컨테이너로 데이터 유지 확인
docker rm -f todo-v1

docker run -d \
  --name todo-v2 \
  -v todo-data:/data \
  -p 8080:80 \
  diamol/ch06-todo-list

# 5. 다시 웹 브라우저로 접속하여 데이터가 유지되는지 확인
```

**결과**: 볼륨을 사용하면 컨테이너가 삭제되어도 데이터가 유지된다!

### 실습 6-4: 볼륨 공유와 백업

```bash
# 1. 데이터가 있는 볼륨을 다른 컨테이너와 공유
docker run -d \
  --name todo-backup \
  -v todo-data:/source:ro \
  -v $(pwd):/backup \
  alpine \
  sh -c "tar czf /backup/todo-backup-$(date +%Y%m%d).tar.gz -C /source ."

# 2. 백업 파일 확인
ls -la todo-backup-*.tar.gz

# 3. 새로운 볼륨에 백업 복원
docker volume create todo-restored

docker run --rm \
  -v todo-restored:/target \
  -v $(pwd):/backup \
  alpine \
  sh -c "tar xzf /backup/todo-backup-*.tar.gz -C /target"

# 4. 복원된 데이터로 컨테이너 실행
docker run -d \
  --name todo-restored-test \
  -v todo-restored:/data \
  -p 8081:80 \
  diamol/ch06-todo-list

# 5. http://localhost:8081에서 복원된 데이터 확인
```

### 실습 6-5: VOLUME vs --volume 차이점 체험

```dockerfile
# Dockerfile 생성
FROM alpine:latest
RUN mkdir /app-data
VOLUME /app-data
CMD ["sh", "-c", "echo 'Container started' > /app-data/startup.log && sleep 3600"]
```

```bash
# 1. 이미지 빌드
docker build -t volume-test .

# 2. VOLUME 인스트럭션만 사용 (자동 볼륨)
docker run -d --name auto-volume volume-test
docker volume ls  # 무작위 이름의 볼륨 생성됨

# 3. --volume 플래그 사용 (명시적 볼륨)  
docker run -d --name named-volume -v my-named-vol:/app-data volume-test
docker volume ls  # my-named-vol 볼륨 생성됨

# 4. 볼륨 내용 확인
docker exec auto-volume cat /app-data/startup.log
docker exec named-volume cat /app-data/startup.log

# 5. 정리
docker rm -f auto-volume named-volume
```

---

## 도커 교과서 핵심 개념

### 볼륨 생명주기 관리

도커 교과서에서 강조하는 볼륨의 핵심 특성:

```
┌─────────────────┐    ┌─────────────────┐
│   컨테이너 1     │◄──►│   도커 볼륨      │
│   (임시)        │    │   (영구)        │
└─────────────────┘    └─────────────────┘
        ▼                       ▲
┌─────────────────┐             │
│   컨테이너 2     │◄────────────┘
│   (새로운)       │
└─────────────────┘
```

### 핵심 개념 정리

- **볼륨(Volume)**: 도커가 관리하는 영구 저장소의 단위
- **마운트 포인트**: 컨테이너 파일 시스템에서 볼륨이 연결되는 경로
- **볼륨 드라이버**: 실제 스토리지 구현 (local, NFS, cloud 등)
- **명명된 볼륨**: 사용자가 지정한 이름을 가진 볼륨 (권장)
- **익명 볼륨**: 도커가 자동 생성한 무작위 이름의 볼륨

---

## 학습 퀴즈

### 퀴즈 1: 볼륨 생성 방식
**Q1**: 다음 중 가장 권장되는 볼륨 사용 방법은?
- A) `VOLUME /data`만 Dockerfile에 선언
- B) `docker run -v /host/path:/container/path`
- C) `docker volume create my-vol && docker run -v my-vol:/data`
- D) `--volumes-from` 옵션 사용

<details>
<summary>정답 보기</summary>
<b>정답: C) docker volume create + -v 명시적 볼륨</b><br>
명시적으로 볼륨을 생성하고 이름을 지정하는 것이 가장 안전하고 관리하기 쉽습니다. 무작위 볼륨명을 피하고 재사용성을 높입니다.
</details>

### 퀴즈 2: 데이터 영속성
**Q2**: 컨테이너를 `docker rm -f container-name`으로 강제 삭제했을 때 볼륨의 데이터는?
- A) 함께 삭제됨
- B) 유지됨
- C) 일부만 삭제됨  
- D) 손상됨

<details>
<summary>정답 보기</summary>
<b>정답: B) 유지됨</b><br>
볼륨은 컨테이너와 독립적인 생명주기를 가지므로, 컨테이너가 삭제되어도 볼륨의 데이터는 그대로 유지됩니다.
</details>

### 퀴즈 3: 볼륨 백업
**Q3**: 볼륨 데이터를 백업하는 가장 안전한 방법은?
- A) 호스트에서 직접 볼륨 디렉터리 복사
- B) 임시 컨테이너에 볼륨을 마운트해서 tar로 압축
- C) docker cp 명령어 사용
- D) 볼륨을 다른 볼륨에 복사

<details>
<summary>정답 보기</summary>
<b>정답: B) 임시 컨테이너에서 tar 압축</b><br>
<code>docker run --rm -v volume-name:/data -v $(pwd):/backup alpine tar czf /backup/data.tar.gz -C /data .</code><br>
이 방법이 가장 안전하고 플랫폼 독립적입니다.
</details>

### 퀴즈 4: 실무 상황
**Q4**: MySQL 컨테이너를 업그레이드할 때 데이터를 보존하려면?
```bash
# 기존 컨테이너
docker run -d --name mysql-old mysql:5.7
```
- A) 컨테이너를 중지하지 말고 이미지만 교체
- B) 볼륨을 미리 생성하고 마운트한 후 컨테이너 교체
- C) docker commit으로 새 이미지 생성
- D) 데이터베이스 덤프 후 복원

<details>
<summary>정답 보기</summary>
<b>정답: B) 볼륨을 미리 생성하고 마운트한 후 컨테이너 교체</b><br>
<pre><code># 올바른 방법
docker volume create mysql-data
docker run -d --name mysql-old -v mysql-data:/var/lib/mysql mysql:5.7
# 업그레이드 시
docker stop mysql-old && docker rm mysql-old
docker run -d --name mysql-new -v mysql-data:/var/lib/mysql mysql:8.0</code></pre>
</details>

---

## 정리

도커 볼륨은 **컨테이너의 임시적 특성과 데이터 영속성의 요구사항을 동시에 만족**시키는 핵심 기술이다. 적절한 볼륨 관리를 통해:

- **데이터 안전성**: 컨테이너 장애나 업데이트 시에도 데이터 보존
- **성능 최적화**: 도커가 최적화된 스토리지 드라이버 활용  
- **운영 편의성**: 백업, 복원, 마이그레이션 간소화
- **확장성**: 여러 컨테이너 간 데이터 공유 및 재사용

## 핵심 메시지

**"볼륨 = 컨테이너의 USB 메모리"** - 이 비유를 기억하세요! 언제든지 꽂았다 뺄 수 있고, 컴퓨터가 바뀌어도 데이터는 그대로 유지되는 USB 메모리처럼, 볼륨도 컨테이너가 바뀌어도 데이터를 안전하게 보관합니다.